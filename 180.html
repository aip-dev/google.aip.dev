<!DOCTYPE html>
<html lang="en-US" class="glue-flexbox">
  <head>
    <title>AIP-180: Backwards compatibility</title>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Google+Sans:400,500|Product+Sans:400&amp;lang=en" rel="stylesheet"></link>
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <link rel="stylesheet" type="text/css" media="screen" href="//www.gstatic.com/glue/v22_1/glue.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=26220397">
    <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css?v=26220397">
    <script type="text/javascript" src="//code.jquery.com/jquery-3.4.0.min.js"></script>
    <script type="text/javascript" src="//www.gstatic.com/glue/latest/glue-detect.min.js"></script>
    <script type="text/javascript">
      $('html').css('visibility', 'hidden');
      $.when($.ready).then(() => {
        $('html').css('visibility', 'visible');
      });
    </script>
    <script type="text/javascript" src="/assets/js/global.js?v=26220397"></script>
    
<script type="text/javascript" src="/assets/js/syntax.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140054909-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-140054909-1');
    </script>
  </head>
  <body>
    <!-- prettier-ignore -->
<header class="glue-header glue-header--single">
  <div class="glue-header__bar glue-header__bar--desktop glue-header__drawer">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- LINK BAR-->
      <div class="glue-header__container glue-header__container--flex-auto">
        <nav class="glue-header__link-bar">
          <ul id="list-1" class="glue-header__list">
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/general" aria-level="1">Browse AIPs</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/news" aria-level="1">News</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/faq" aria-level="1">FAQ</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/contributing" aria-level="1">Contributing</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="https://linter.aip.dev/" target="_blank" aria-level="1">
                    API Linter
                    <svg role="img" class="glue-icon glue-icon--18px">
                      <use xlink:href="/assets/images/glue-icons.svg#open-in-new"></use>
                    </svg>
                  </a>
                </li>
              
            
          </ul>
        </nav>
      </div>
      <!-- CTA-->
      <div class="glue-header__container glue-header__container--cta">
        <div class="glue-header__cta">
        <div class="glue-sitesearch">
          <form method="GET" action="/search">
          <label for="q">Search this site</label>
          <input class="glue-sitesearch__input" type="text" name="q" id="q"
            placeholder="Search AIPs">
          <button type="submit" class="glue-button glue-sitesearch__submit" title="Submit">
            <svg role="img" class="glue-icon glue-icon--24px">
            <use xlink:href="/assets/images/glue-icons.svg#search"></use>
            </svg>
          </button>
          </form>
        </div>
        <a href="https://github.com/aip-dev/google.aip.dev" target="_blank" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile header placeholder -->
  <div class="glue-header__bar glue-header__bar--mobile">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__hamburger glue-header__hamburger--first-tier">
            <div class="glue-header__hamburger-wrapper">
              <button type="button" class="glue-header__drawer-toggle-btn"
                aria-controls="drawer" aria-expanded="false" aria-label="Open the navigation drawer">
                <svg role="img" class="glue-icon glue-icon--24px"><use xlink:href="/assets/images/glue-icons.svg#menu"></use></svg>
              </button>
            </div>
          </div>
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                  <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <!-- SKIP -->
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- CTA -->
      <div class="glue-header__container">
        <div class="glue-header__cta">
        <a href="https://github.com/aip-dev/google.aip.dev" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <div class="glue-header__drawer-backdrop"></div>
</header>
    <div class="glue-page">
      
      <main role="main" id="page-content">
        
<nav id="aip-nav" class="docs-component-nav">
  <ul class="nav-list">
    <li class="nav-item nav-item-header">AIPs by Scope</li>
    <li class="nav-item">
      <a href="/general">General</a>
    </li>
    <li class="nav-item">
      <a href="/cloud">Google Cloud Platform</a>
    </li>
    <li class="nav-item">
      <a href="/auth">Auth</a>
    </li>
    <li class="nav-item">
      <a href="/client-libraries">Client libraries</a>
    </li>
    <li class="nav-item">
      <a href="/apps">GSuite</a>
    </li>
    <li class="nav-item">
      <a href="/aog">Actions on Google</a>
    </li>
    <li class="nav-item nav-item-header">AIPs</li>
    <li class="nav-item">
      <a href="/1">
        <span class="aip-number">1</span>
        AIP Purpose and Guidelines
      </a>
    </li>
    <li class="nav-item">
      <a href="/2">
        <span class="aip-number">2</span>
        AIP Numbering
      </a>
    </li>
    <li class="nav-item">
      <a href="/3">
        <span class="aip-number">3</span>
        AIP Versioning
      </a>
    </li>
    <li class="nav-item">
      <a href="/8">
        <span class="aip-number">8</span>
        AIP Style and Guidance
      </a>
    </li>
    <li class="nav-item">
      <a href="/9">
        <span class="aip-number">9</span>
        Glossary
      </a>
    </li>
    <li class="nav-item">
      <a href="/100">
        <span class="aip-number">100</span>
        API Design Review FAQ
      </a>
    </li>
    <li class="nav-item">
      <a href="/111">
        <span class="aip-number">111</span>
        Planes
      </a>
    </li>
    <li class="nav-item">
      <a href="/121">
        <span class="aip-number">121</span>
        Resource-oriented design
      </a>
    </li>
    <li class="nav-item">
      <a href="/122">
        <span class="aip-number">122</span>
        Resource names
      </a>
    </li>
    <li class="nav-item">
      <a href="/123">
        <span class="aip-number">123</span>
        Resource types
      </a>
    </li>
    <li class="nav-item">
      <a href="/124">
        <span class="aip-number">124</span>
        Resource association
      </a>
    </li>
    <li class="nav-item">
      <a href="/126">
        <span class="aip-number">126</span>
        Enumerations
      </a>
    </li>
    <li class="nav-item">
      <a href="/127">
        <span class="aip-number">127</span>
        HTTP and gRPC Transcoding
      </a>
    </li>
    <li class="nav-item">
      <a href="/128">
        <span class="aip-number">128</span>
        Declarative-friendly interfaces
      </a>
    </li>
    <li class="nav-item">
      <a href="/129">
        <span class="aip-number">129</span>
        Server-Modified Values and Defaults
      </a>
    </li>
    <li class="nav-item">
      <a href="/130">
        <span class="aip-number">130</span>
        Methods
      </a>
    </li>
    <li class="nav-item">
      <a href="/131">
        <span class="aip-number">131</span>
        Standard methods: Get
      </a>
    </li>
    <li class="nav-item">
      <a href="/132">
        <span class="aip-number">132</span>
        Standard methods: List
      </a>
    </li>
    <li class="nav-item">
      <a href="/133">
        <span class="aip-number">133</span>
        Standard methods: Create
      </a>
    </li>
    <li class="nav-item">
      <a href="/134">
        <span class="aip-number">134</span>
        Standard methods: Update
      </a>
    </li>
    <li class="nav-item">
      <a href="/135">
        <span class="aip-number">135</span>
        Standard methods: Delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/136">
        <span class="aip-number">136</span>
        Custom methods
      </a>
    </li>
    <li class="nav-item">
      <a href="/140">
        <span class="aip-number">140</span>
        Field names
      </a>
    </li>
    <li class="nav-item">
      <a href="/141">
        <span class="aip-number">141</span>
        Quantities
      </a>
    </li>
    <li class="nav-item">
      <a href="/142">
        <span class="aip-number">142</span>
        Time and duration
      </a>
    </li>
    <li class="nav-item">
      <a href="/143">
        <span class="aip-number">143</span>
        Standardized codes
      </a>
    </li>
    <li class="nav-item">
      <a href="/144">
        <span class="aip-number">144</span>
        Repeated fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/145">
        <span class="aip-number">145</span>
        Ranges
      </a>
    </li>
    <li class="nav-item">
      <a href="/146">
        <span class="aip-number">146</span>
        Generic fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/147">
        <span class="aip-number">147</span>
        Sensitive fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/148">
        <span class="aip-number">148</span>
        Standard fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/149">
        <span class="aip-number">149</span>
        Unset field values
      </a>
    </li>
    <li class="nav-item">
      <a href="/151">
        <span class="aip-number">151</span>
        Long-running operations
      </a>
    </li>
    <li class="nav-item">
      <a href="/152">
        <span class="aip-number">152</span>
        Jobs
      </a>
    </li>
    <li class="nav-item">
      <a href="/153">
        <span class="aip-number">153</span>
        Import and export
      </a>
    </li>
    <li class="nav-item">
      <a href="/154">
        <span class="aip-number">154</span>
        Resource freshness validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/155">
        <span class="aip-number">155</span>
        Request identification
      </a>
    </li>
    <li class="nav-item">
      <a href="/156">
        <span class="aip-number">156</span>
        Singleton resources
      </a>
    </li>
    <li class="nav-item">
      <a href="/157">
        <span class="aip-number">157</span>
        Partial responses
      </a>
    </li>
    <li class="nav-item">
      <a href="/158">
        <span class="aip-number">158</span>
        Pagination
      </a>
    </li>
    <li class="nav-item">
      <a href="/159">
        <span class="aip-number">159</span>
        Reading across collections
      </a>
    </li>
    <li class="nav-item">
      <a href="/160">
        <span class="aip-number">160</span>
        Filtering
      </a>
    </li>
    <li class="nav-item">
      <a href="/161">
        <span class="aip-number">161</span>
        Field masks
      </a>
    </li>
    <li class="nav-item">
      <a href="/162">
        <span class="aip-number">162</span>
        Resource Revisions
      </a>
    </li>
    <li class="nav-item">
      <a href="/163">
        <span class="aip-number">163</span>
        Change validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/164">
        <span class="aip-number">164</span>
        Soft delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/165">
        <span class="aip-number">165</span>
        Criteria-based delete
      </a>
    </li>
    <li class="nav-item nav-item-active">
      <a href="/180">
        <span class="aip-number">180</span>
        Backwards compatibility
      </a>
    </li>
    <li class="nav-item">
      <a href="/181">
        <span class="aip-number">181</span>
        Stability levels
      </a>
    </li>
    <li class="nav-item">
      <a href="/182">
        <span class="aip-number">182</span>
        External software dependencies
      </a>
    </li>
    <li class="nav-item">
      <a href="/185">
        <span class="aip-number">185</span>
        API Versioning
      </a>
    </li>
    <li class="nav-item">
      <a href="/191">
        <span class="aip-number">191</span>
        File and directory structure
      </a>
    </li>
    <li class="nav-item">
      <a href="/192">
        <span class="aip-number">192</span>
        Documentation
      </a>
    </li>
    <li class="nav-item">
      <a href="/193">
        <span class="aip-number">193</span>
        Errors
      </a>
    </li>
    <li class="nav-item">
      <a href="/194">
        <span class="aip-number">194</span>
        Automatic retry configuration
      </a>
    </li>
    <li class="nav-item">
      <a href="/200">
        <span class="aip-number">200</span>
        Precedent
      </a>
    </li>
    <li class="nav-item">
      <a href="/202">
        <span class="aip-number">202</span>
        Fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/203">
        <span class="aip-number">203</span>
        Field behavior documentation
      </a>
    </li>
    <li class="nav-item">
      <a href="/205">
        <span class="aip-number">205</span>
        Beta-blocking changes
      </a>
    </li>
    <li class="nav-item">
      <a href="/210">
        <span class="aip-number">210</span>
        Unicode
      </a>
    </li>
    <li class="nav-item">
      <a href="/211">
        <span class="aip-number">211</span>
        Authorization checks
      </a>
    </li>
    <li class="nav-item">
      <a href="/213">
        <span class="aip-number">213</span>
        Common components
      </a>
    </li>
    <li class="nav-item">
      <a href="/214">
        <span class="aip-number">214</span>
        Resource expiration
      </a>
    </li>
    <li class="nav-item">
      <a href="/215">
        <span class="aip-number">215</span>
        API-specific protos
      </a>
    </li>
    <li class="nav-item">
      <a href="/216">
        <span class="aip-number">216</span>
        States
      </a>
    </li>
    <li class="nav-item">
      <a href="/217">
        <span class="aip-number">217</span>
        Unreachable resources
      </a>
    </li>
    <li class="nav-item">
      <a href="/231">
        <span class="aip-number">231</span>
        Batch methods: Get
      </a>
    </li>
    <li class="nav-item">
      <a href="/233">
        <span class="aip-number">233</span>
        Batch methods: Create
      </a>
    </li>
    <li class="nav-item">
      <a href="/234">
        <span class="aip-number">234</span>
        Batch methods: Update
      </a>
    </li>
    <li class="nav-item">
      <a href="/235">
        <span class="aip-number">235</span>
        Batch methods: Delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/236">
        <span class="aip-number">236</span>
        Policy preview
      </a>
    </li>
    </ul>
</nav>
<section id="jump-content">
          
<aside id="aip-sidebar" class="docs-component-sidebar">
  <table id="aip-summary">
    <tr><th colspan="2">Backwards compatibility</th></tr>
    <tr><td>Number</td><td>180</td></tr>
    <tr><td>Permalink</td><td><a href="https://google.aip.dev/180">google.aip.dev/180</a></td></tr>
    <tr><td>State</td><td>Approved</td></tr>
    <tr><td>Created</td><td>2019-07-23</td></tr>
    <tr><td>Updated</td><td>2019-07-23</td></tr>
  </table>

  <section id="aip-toc" class="docs-component-sidebar-toc">
    <div class="toc"><span class="toctitle">Contents</span><ul>
<li><a href="#guidance">Guidance</a><ul>
<li><a href="#adding-components">Adding components</a></li>
<li><a href="#removing-or-renaming-components">Removing or renaming components</a></li>
<li><a href="#moving-components-between-files">Moving components between files</a></li>
<li><a href="#moving-into-oneofs">Moving into oneofs</a></li>
<li><a href="#changing-the-type-of-fields">Changing the type of fields</a></li>
<li><a href="#changing-resource-names">Changing resource names</a></li>
<li><a href="#semantic-changes">Semantic changes</a></li>
</ul>
</li>
<li><a href="#further-reading">Further reading</a></li>
<li><a href="#changelog">Changelog</a></li>
</ul>
</div>

  </section>

  <section class="docs-component-sidebar-actions">
    <ul>
      <li><a href="https://github.com/aip-dev/google.aip.dev/issues/">File Bug</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/blob/master/aip/general/0180.md">View source</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/edit/master/aip/general/0180.md">Edit this page</a></li>
    </ul>
  </section>
</aside>
<section id="aip-main" class="docs-component-main">
  <section class="section-breadcrumbs">
  <nav
    class="glue-breadcrumbs glue-mod-mt-std glue-mod-mb-std"
    aria-label="You are here."
  >
    <ol class="glue-breadcrumbs__list aip-breadcrumbs">
      <li class="glue-breadcrumbs__item" aria-level="1">
        <a class="glue-breadcrumbs__link" href="/">
          API Improvement Proposals
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item" aria-level="2">
        <a class="glue-breadcrumbs__link" href="/general">
          General AIPs
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item glue-breadcrumbs__item--active"
          aria-level="3">
        Backwards compatibility
      </li>
    </ol>
  </nav>
</section>
  
  <h4 class="aip-number">AIP-180</h4>
  <h1 id="backwards-compatibility">Backwards compatibility</h1>
<p>APIs are fundamentally contracts with users, and users often write code against
APIs that is then launched into a production service with the expectation that
it continues to work (unless the API has a <a href="/181">stability level</a> that
indicates otherwise). Therefore, it is important to understand what constitutes
a backwards compatible change and what constitutes a backwards incompatible
change.</p>
<h2 id="guidance">Guidance</h2>
<p>Existing client code <strong>must not</strong> be broken by a service updating to a new
minor or patch release. Old clients <strong>must</strong> be able to work against newer
servers (with the same major version number).</p>
<p><strong>Important:</strong> It is not always clear whether a change is compatible or not.
The guidance here <strong>should</strong> be treated as indicative, rather than as a
comprehensive list of every possible change.</p>
<p>There are three distinct types of compatibility to consider:</p>
<ol>
<li>Source compatibility: Code written against a previous version <strong>must</strong>
   compile against a newer version, and successfully run with a newer version
   of the client library.</li>
<li>Wire compatibility: Code written against a previous version <strong>must</strong> be able
   to communicate correctly with a newer server. In other words, not only are
   inputs and outputs compatible, but the serialization and deserialization
   expectations continue to match.</li>
<li>Semantic compatibility: Code written against a previous version <strong>must</strong>
   continue to receive what most reasonable developers would expect. (This can
   be tricky in practice, however, and sometimes determining what users will
   expect can involve a judgment call.)</li>
</ol>
<p><strong>Note:</strong> In general, the specific guidance here assumes use of protocol
buffers and JSON as transport formats. Other transport formats may have
slightly different rules.</p>
<p><strong>Note:</strong> This guidance assumes that APIs are intended to be called from a
range of consumers, written in multiple languages and with no control over
how and when consumers update. Any API which has a more limited scope (for
example, an API which is only called by client code written by the same team
as the API producer, or deployed in a way which can enforce updates) should
carefully consider its own compatibility requirements.</p>
<h3 id="adding-components">Adding components</h3>
<p>In general, new components (interfaces, methods, messages, fields, enums, or
enum values) <strong>may</strong> be added to existing APIs in the same major version.</p>
<p>However, keep the following guidelines in mind when doing this:</p>
<ul>
<li>Code written against the previous surface (and thus is unaware of the new
  components) <strong>must</strong> continue to be treated the same way as before.<ul>
<li>New required fields <strong>must not</strong> be added to existing request messages or
  resources.</li>
<li>Any field being populated by clients <strong>must</strong> have a default behavior
  matching the behavior before the field was introduced.</li>
<li>Any field previously populated by the server <strong>must</strong> continue to be
  populated, even if it introduces redundancy.</li>
</ul>
</li>
<li>For enum values specifically, be aware that it is possible that user code
  does not handle new values gracefully.<ul>
<li>Enum values <strong>may</strong> be freely added to enums which are only used in request
  messages.</li>
<li>Enums that are used in response messages or resources and which are
  expected to receive new values <strong>should</strong> document this. Enum values still
  <strong>may</strong> be added in this situation; however, appropriate caution <strong>should</strong>
  be used.</li>
</ul>
</li>
</ul>
<p><strong>Note:</strong> It is possible when adding a component closely related to an existing
component (for example, <code>string foo_value</code> when <code>string foo</code> already exists) to
enter a situation where generated code will conflict. Service owners <strong>should</strong>
be aware of subtleties in the tooling they or their users are likely to use
(and tool authors <strong>should</strong> endeavor to avoid such subtleties if possible).</p>
<h3 id="removing-or-renaming-components">Removing or renaming components</h3>
<p>Existing components (interfaces, methods, messages, fields, enums, or enum
values) <strong>must not</strong> be removed from existing APIs in the same major version.
Removing a component is a backwards incompatible change.</p>
<p><strong>Important:</strong> Renaming a component is semantically equivalent to "remove and
add". In cases where these sorts of changes are desirable, a service <strong>may</strong>
add the new component, but <strong>must not</strong> remove the existing one. In situations
where this can allow users to specify conflicting values for the same semantic
idea, the behavior <strong>must</strong> be clearly specified.</p>
<h3 id="moving-components-between-files">Moving components between files</h3>
<p>Existing components <strong>must not</strong> be moved between files.</p>
<p>Moving a component from one proto file to another within the same package is
wire compatible, however, the code generated for languages like C++ or Python
will result in breaking change since <code>import</code> and <code>#include</code> will no longer
point to the correct code location.</p>
<h3 id="moving-into-oneofs">Moving into oneofs</h3>
<p>Existing fields <strong>must not</strong> be moved into or out of a oneof. This is a
backwards-incompatible change in the Go protobuf stubs.</p>
<h3 id="changing-the-type-of-fields">Changing the type of fields</h3>
<p>Existing fields and messages <strong>must not</strong> have their type changed, even if the
new type is wire-compatible, because type changes alter generated code in a
breaking way.</p>
<h3 id="changing-resource-names">Changing resource names</h3>
<p>A resource <strong>must not</strong> change its <a href="/122">name</a>.</p>
<p>Unlike most breaking changes, this affects major versions as well: in order for
a client to expect to use v2.0 access a resource that was created in v1.0 or
vice versa, the same resource name <strong>must</strong> be used in both versions.</p>
<p>More subtly, the set of valid resource names <strong>should not</strong> change either, for
the following reasons:</p>
<ul>
<li>If resource name formats become more restrictive, a request that would
  previously have succeeded will now fail.</li>
<li>If resource name formats become less restrictive than previously documented,
  then code making assumptions based on the previous documentation could break.
  Users are very likely to store resource names elsewhere, in ways that may be
  sensitive to the set of permitted characters and the length of the name.
  Alternatively, users might perform their own resource name validation to
  follow the documentation.<ul>
<li>For example, Amazon gave customers <a href="https://aws.amazon.com/blogs/aws/theyre-here-longer-ec2-resource-ids-now-available/">a lot of warning</a> and had a
  migration period when they started allowing longer EC2 resource IDs.</li>
</ul>
</li>
</ul>
<h3 id="semantic-changes">Semantic changes</h3>
<p>Code will often depend on API behavior and semantics, <em>even when such behavior
is not explicitly supported or documented</em>. Therefore, APIs <strong>must not</strong> change
visible behavior or semantics in ways that are likely to break reasonable user
code, as such changes will be seen as breaking by those users.</p>
<p><strong>Note:</strong> This does involve some level of judgment; it is not always clear
whether a proposed change is likely to break users, and an expansive reading of
this guidance could ostensibly prevent <em>any</em> change (which is not the intent).</p>
<h4 id="default-values-must-not-change">Default values must not change</h4>
<p>Default values are the values set by servers for resources when they are not
specified by the client. This section only applies to static default values within
fields on resources and does not apply to dynamic defaults such as the default IP
address of a resource.</p>
<p>Changing the default value is considered breaking and <strong>must not</strong> be done. The
default behavior for a resource is determined by its default values, and this
<strong>must not</strong> change across minor versions.</p>
<p>For example:</p>
<div class="highlight language-proto"><pre><span></span><code><span class="kd">message</span> <span class="nc">Book</span> <span class="p">{</span>
    <span class="c1">// google.api.resource and other annotations and fields</span>

    <span class="c1">// The genre of the book</span>
    <span class="c1">// If this is not set when the book is created, the field will be given a value of FICTION.</span>
    <span class="kd">enum</span> <span class="n">Genre</span> <span class="p">{</span>
      <span class="na">UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="na">FICTION</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="na">NONFICTION</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Changing to:</p>
<div class="highlight language-proto"><pre><span></span><code><span class="kd">message</span> <span class="nc">Book</span> <span class="p">{</span>
    <span class="c1">// google.api.resource and other annotations and fields</span>

    <span class="c1">// The genre of the book</span>
    <span class="c1">// If this is not set when the book is created, the field will be given a value of NONFICTION.</span>
    <span class="kd">enum</span> <span class="n">Genre</span> <span class="p">{</span>
      <span class="na">UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="na">FICTION</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="na">NONFICTION</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>would constitute a breaking change.</p>
<h4 id="serializing-defaults">Serializing defaults</h4>
<p>APIs <strong>must not</strong> change the way a field with a default value is serialized. For
example if a field does not appear in the response if the value is equal to the
default, the serialization <strong>must not</strong> change to include the field with the
default. Clients may depend on the presence or absence of a field in a resource
as semantically meaningful, so a change to how serialization is done for absent
values <strong>must not</strong> occur in a minor version.</p>
<p>Consider the following proto, where the default value of <code>wheels</code> is <code>2</code>:</p>
<div class="highlight language-proto"><pre><span></span><code><span class="c1">// A representation of an automobile</span>
<span class="kd">message</span> <span class="nc">Automobile</span> <span class="p">{</span>
    <span class="c1">// google.api.resource and other annotations and fields</span>

    <span class="c1">// The number of wheels on the automobile.</span>
    <span class="c1">// The default value is 2, when no value is sent by the client.</span>
    <span class="n">int</span> <span class="na">wheels</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>First the proto serializes to JSON when the value of <code>wheels</code> is <code>2</code> as follows:</p>
<div class="highlight language-json"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-car&quot;</span>
<span class="p">}</span>
</code></pre></div>
<p>Then, the API service changes the serialization to include <code>wheel</code> even if the
value is equal to the default value, <code>2</code> as follows:</p>
<div class="highlight language-json"><pre><span></span><code><span class="p">{</span>
    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-car&quot;</span><span class="p">,</span>
    <span class="nt">&quot;wheels&quot;</span><span class="p">:</span> <span class="mi">2</span>
<span class="p">}</span>
</code></pre></div>
<p>This constitutes a change that is not backwards compatible within a major
version.</p>
<h2 id="further-reading">Further reading</h2>
<ul>
<li>For compatibility around field behavior, see <a href="/203">AIP-203</a>.</li>
<li>For compatibility around pagination, see <a href="/158">AIP-158</a>.</li>
<li>For compatibility around long-running operations, see <a href="/151">AIP-151</a>.</li>
<li>For understanding stability levels and expectations, see <a href="/181">AIP-181</a>.</li>
<li>For compatibility with client library resource name parsing, see <a href="https://google.aip.dev/client-libraries/4231">AIP-4231</a></li>
<li>For compatibility with client library method signatures, see <a href="https://google.aip.dev/client-libraries/4232">AIP-4232</a></li>
<li>For compatibility around field presence changes, see <a href="/149">AIP-149</a>.</li>
<li>For compatibility around resource types, see <a href="/123">AIP-123</a>.</li>
</ul>
<h2 id="changelog">Changelog</h2>
<ul>
<li><strong>2024-08-07</strong>: Added reference to resource type compatibility.</li>
<li><strong>2024-06-05</strong>: Added reference to field presence compatibility.</li>
<li><strong>2023-07-26</strong>: Added reference to field behavior compatibility.</li>
<li><strong>2023-07-26</strong>: Added note on APIs which have limited clients.</li>
<li><strong>2022-08-11</strong>: Added "Moving components between files" section.</li>
<li><strong>2022-06-01</strong>: Added more links to other AIPs with compatibility concerns</li>
<li><strong>2019-12-16</strong>: Clarified that moving existing fields into oneofs is
  breaking.</li>
</ul>
<!-- prettier-ignore-start -->
<!-- prettier-ignore-end -->
  <footer>
  Except as otherwise noted, the content of this page is licensed under the
  <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
  Attribution 4.0 License</a>, and code samples are licensed under the
  <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
  <span class="no-print">For details, see <a href="/licensing">content
  licensing</a>.</span>
</footer>
</section>

        </section>
      </main>
      
    </div>
    <script src="//www.gstatic.com/external_hosted/hammerjs/v2_0_2/hammer.min.js"></script>
    <script src="//www.gstatic.com/glue/v22_1/glue-vanilla.min.js"></script>
    <script type="text/javascript">
      const headerElement = document.querySelector('.glue-header');
      if (headerElement) {
        new window.glue.ui.header.Header(headerElement);
      }
    </script>
  </body>
</html>