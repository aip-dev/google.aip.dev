<!DOCTYPE html>
<html lang="en-US" class="glue-flexbox">
  <head>
    <title>AIP-151: Long-running operations</title>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Google+Sans:400,500|Product+Sans:400&amp;lang=en" rel="stylesheet"></link>
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <link rel="stylesheet" type="text/css" media="screen" href="//www.gstatic.com/glue/v22_1/glue.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=ca097262">
    <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css?v=ca097262">
    <script type="text/javascript" src="//code.jquery.com/jquery-3.4.0.min.js"></script>
    <script type="text/javascript" src="//www.gstatic.com/glue/latest/glue-detect.min.js"></script>
    <script type="text/javascript">
      $('html').css('visibility', 'hidden');
      $.when($.ready).then(() => {
        $('html').css('visibility', 'visible');
      });
    </script>
    <script type="text/javascript" src="/assets/js/global.js?v=ca097262"></script>
    
<script type="text/javascript" src="/assets/js/syntax.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140054909-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-140054909-1');
    </script>
  </head>
  <body>
    <!-- prettier-ignore -->
<header class="glue-header glue-header--single">
  <div class="glue-header__bar glue-header__bar--desktop glue-header__drawer">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- LINK BAR-->
      <div class="glue-header__container glue-header__container--flex-auto">
        <nav class="glue-header__link-bar">
          <ul id="list-1" class="glue-header__list">
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/general" aria-level="1">Browse AIPs</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/news" aria-level="1">News</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/faq" aria-level="1">FAQ</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/contributing" aria-level="1">Contributing</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="https://linter.aip.dev/" target="_blank" aria-level="1">
                    API Linter
                    <svg role="img" class="glue-icon glue-icon--18px">
                      <use xlink:href="/assets/images/glue-icons.svg#open-in-new"></use>
                    </svg>
                  </a>
                </li>
              
            
          </ul>
        </nav>
      </div>
      <!-- CTA-->
      <div class="glue-header__container glue-header__container--cta">
        <div class="glue-header__cta">
        <div class="glue-sitesearch">
          <form method="GET" action="/search">
          <label for="q">Search this site</label>
          <input class="glue-sitesearch__input" type="text" name="q" id="q"
            placeholder="Search AIPs">
          <button type="submit" class="glue-button glue-sitesearch__submit" title="Submit">
            <svg role="img" class="glue-icon glue-icon--24px">
            <use xlink:href="/assets/images/glue-icons.svg#search"></use>
            </svg>
          </button>
          </form>
        </div>
        <a href="https://github.com/aip-dev/google.aip.dev" target="_blank" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile header placeholder -->
  <div class="glue-header__bar glue-header__bar--mobile">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__hamburger glue-header__hamburger--first-tier">
            <div class="glue-header__hamburger-wrapper">
              <button type="button" class="glue-header__drawer-toggle-btn"
                aria-controls="drawer" aria-expanded="false" aria-label="Open the navigation drawer">
                <svg role="img" class="glue-icon glue-icon--24px"><use xlink:href="/assets/images/glue-icons.svg#menu"></use></svg>
              </button>
            </div>
          </div>
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                  <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <!-- SKIP -->
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- CTA -->
      <div class="glue-header__container">
        <div class="glue-header__cta">
        <a href="https://github.com/aip-dev/google.aip.dev" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <div class="glue-header__drawer-backdrop"></div>
</header>
    <div class="glue-page">
      
      <main role="main" id="page-content">
        
<nav id="aip-nav" class="docs-component-nav">
  <ul class="nav-list">
    <li class="nav-item nav-item-header">AIPs by Scope</li>
    <li class="nav-item">
      <a href="/general">General</a>
    </li>
    <li class="nav-item">
      <a href="/cloud">Google Cloud Platform</a>
    </li>
    <li class="nav-item">
      <a href="/auth">Auth</a>
    </li>
    <li class="nav-item">
      <a href="/client-libraries">Client libraries</a>
    </li>
    <li class="nav-item">
      <a href="/apps">Workspace</a>
    </li>
    <li class="nav-item">
      <a href="/aog">Actions on Google</a>
    </li>
    <li class="nav-item nav-item-header">AIPs</li>
    <li class="nav-item">
      <a href="/1">
        <span class="aip-number">1</span>
        AIP Purpose and Guidelines
      </a>
    </li>
    <li class="nav-item">
      <a href="/2">
        <span class="aip-number">2</span>
        AIP Numbering
      </a>
    </li>
    <li class="nav-item">
      <a href="/3">
        <span class="aip-number">3</span>
        AIP Versioning
      </a>
    </li>
    <li class="nav-item">
      <a href="/8">
        <span class="aip-number">8</span>
        AIP Style and Guidance
      </a>
    </li>
    <li class="nav-item">
      <a href="/9">
        <span class="aip-number">9</span>
        Glossary
      </a>
    </li>
    <li class="nav-item">
      <a href="/100">
        <span class="aip-number">100</span>
        API Design Review FAQ
      </a>
    </li>
    <li class="nav-item">
      <a href="/111">
        <span class="aip-number">111</span>
        Planes
      </a>
    </li>
    <li class="nav-item">
      <a href="/121">
        <span class="aip-number">121</span>
        Resource-oriented design
      </a>
    </li>
    <li class="nav-item">
      <a href="/122">
        <span class="aip-number">122</span>
        Resource names
      </a>
    </li>
    <li class="nav-item">
      <a href="/123">
        <span class="aip-number">123</span>
        Resource types
      </a>
    </li>
    <li class="nav-item">
      <a href="/124">
        <span class="aip-number">124</span>
        Resource association
      </a>
    </li>
    <li class="nav-item">
      <a href="/126">
        <span class="aip-number">126</span>
        Enumerations
      </a>
    </li>
    <li class="nav-item">
      <a href="/127">
        <span class="aip-number">127</span>
        HTTP and gRPC Transcoding
      </a>
    </li>
    <li class="nav-item">
      <a href="/128">
        <span class="aip-number">128</span>
        Declarative-friendly interfaces
      </a>
    </li>
    <li class="nav-item">
      <a href="/129">
        <span class="aip-number">129</span>
        Server-Modified Values and Defaults
      </a>
    </li>
    <li class="nav-item">
      <a href="/130">
        <span class="aip-number">130</span>
        Methods
      </a>
    </li>
    <li class="nav-item">
      <a href="/131">
        <span class="aip-number">131</span>
        Standard methods: Get
      </a>
    </li>
    <li class="nav-item">
      <a href="/132">
        <span class="aip-number">132</span>
        Standard methods: List
      </a>
    </li>
    <li class="nav-item">
      <a href="/133">
        <span class="aip-number">133</span>
        Standard methods: Create
      </a>
    </li>
    <li class="nav-item">
      <a href="/134">
        <span class="aip-number">134</span>
        Standard methods: Update
      </a>
    </li>
    <li class="nav-item">
      <a href="/135">
        <span class="aip-number">135</span>
        Standard methods: Delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/136">
        <span class="aip-number">136</span>
        Custom methods
      </a>
    </li>
    <li class="nav-item">
      <a href="/140">
        <span class="aip-number">140</span>
        Field names
      </a>
    </li>
    <li class="nav-item">
      <a href="/141">
        <span class="aip-number">141</span>
        Quantities
      </a>
    </li>
    <li class="nav-item">
      <a href="/142">
        <span class="aip-number">142</span>
        Time and duration
      </a>
    </li>
    <li class="nav-item">
      <a href="/143">
        <span class="aip-number">143</span>
        Standardized codes
      </a>
    </li>
    <li class="nav-item">
      <a href="/144">
        <span class="aip-number">144</span>
        Repeated fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/145">
        <span class="aip-number">145</span>
        Ranges
      </a>
    </li>
    <li class="nav-item">
      <a href="/146">
        <span class="aip-number">146</span>
        Generic fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/147">
        <span class="aip-number">147</span>
        Sensitive fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/148">
        <span class="aip-number">148</span>
        Standard fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/149">
        <span class="aip-number">149</span>
        Unset field values
      </a>
    </li>
    <li class="nav-item nav-item-active">
      <a href="/151">
        <span class="aip-number">151</span>
        Long-running operations
      </a>
    </li>
    <li class="nav-item">
      <a href="/152">
        <span class="aip-number">152</span>
        Jobs
      </a>
    </li>
    <li class="nav-item">
      <a href="/153">
        <span class="aip-number">153</span>
        Import and export
      </a>
    </li>
    <li class="nav-item">
      <a href="/154">
        <span class="aip-number">154</span>
        Resource freshness validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/155">
        <span class="aip-number">155</span>
        Request identification
      </a>
    </li>
    <li class="nav-item">
      <a href="/156">
        <span class="aip-number">156</span>
        Singleton resources
      </a>
    </li>
    <li class="nav-item">
      <a href="/157">
        <span class="aip-number">157</span>
        Partial responses
      </a>
    </li>
    <li class="nav-item">
      <a href="/158">
        <span class="aip-number">158</span>
        Pagination
      </a>
    </li>
    <li class="nav-item">
      <a href="/159">
        <span class="aip-number">159</span>
        Reading across collections
      </a>
    </li>
    <li class="nav-item">
      <a href="/160">
        <span class="aip-number">160</span>
        Filtering
      </a>
    </li>
    <li class="nav-item">
      <a href="/161">
        <span class="aip-number">161</span>
        Field masks
      </a>
    </li>
    <li class="nav-item">
      <a href="/162">
        <span class="aip-number">162</span>
        Resource Revisions
      </a>
    </li>
    <li class="nav-item">
      <a href="/163">
        <span class="aip-number">163</span>
        Change validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/164">
        <span class="aip-number">164</span>
        Soft delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/165">
        <span class="aip-number">165</span>
        Criteria-based delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/180">
        <span class="aip-number">180</span>
        Backwards compatibility
      </a>
    </li>
    <li class="nav-item">
      <a href="/181">
        <span class="aip-number">181</span>
        Stability levels
      </a>
    </li>
    <li class="nav-item">
      <a href="/182">
        <span class="aip-number">182</span>
        External software dependencies
      </a>
    </li>
    <li class="nav-item">
      <a href="/185">
        <span class="aip-number">185</span>
        API Versioning
      </a>
    </li>
    <li class="nav-item">
      <a href="/190">
        <span class="aip-number">190</span>
        Naming conventions
      </a>
    </li>
    <li class="nav-item">
      <a href="/191">
        <span class="aip-number">191</span>
        File and directory structure
      </a>
    </li>
    <li class="nav-item">
      <a href="/192">
        <span class="aip-number">192</span>
        Documentation
      </a>
    </li>
    <li class="nav-item">
      <a href="/193">
        <span class="aip-number">193</span>
        Errors
      </a>
    </li>
    <li class="nav-item">
      <a href="/194">
        <span class="aip-number">194</span>
        Automatic retry configuration
      </a>
    </li>
    <li class="nav-item">
      <a href="/200">
        <span class="aip-number">200</span>
        Precedent
      </a>
    </li>
    <li class="nav-item">
      <a href="/202">
        <span class="aip-number">202</span>
        Fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/203">
        <span class="aip-number">203</span>
        Field behavior documentation
      </a>
    </li>
    <li class="nav-item">
      <a href="/205">
        <span class="aip-number">205</span>
        Beta-blocking changes
      </a>
    </li>
    <li class="nav-item">
      <a href="/210">
        <span class="aip-number">210</span>
        Unicode
      </a>
    </li>
    <li class="nav-item">
      <a href="/211">
        <span class="aip-number">211</span>
        Authorization checks
      </a>
    </li>
    <li class="nav-item">
      <a href="/213">
        <span class="aip-number">213</span>
        Common components
      </a>
    </li>
    <li class="nav-item">
      <a href="/214">
        <span class="aip-number">214</span>
        Resource expiration
      </a>
    </li>
    <li class="nav-item">
      <a href="/215">
        <span class="aip-number">215</span>
        API-specific protos
      </a>
    </li>
    <li class="nav-item">
      <a href="/216">
        <span class="aip-number">216</span>
        States
      </a>
    </li>
    <li class="nav-item">
      <a href="/217">
        <span class="aip-number">217</span>
        Unreachable resources
      </a>
    </li>
    <li class="nav-item">
      <a href="/231">
        <span class="aip-number">231</span>
        Batch methods: Get
      </a>
    </li>
    <li class="nav-item">
      <a href="/233">
        <span class="aip-number">233</span>
        Batch methods: Create
      </a>
    </li>
    <li class="nav-item">
      <a href="/234">
        <span class="aip-number">234</span>
        Batch methods: Update
      </a>
    </li>
    <li class="nav-item">
      <a href="/235">
        <span class="aip-number">235</span>
        Batch methods: Delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/236">
        <span class="aip-number">236</span>
        Policy preview
      </a>
    </li>
    </ul>
</nav>
<section id="jump-content">
          
<aside id="aip-sidebar" class="docs-component-sidebar">
  <table id="aip-summary">
    <tr><th colspan="2">Long-running operations</th></tr>
    <tr><td>Number</td><td>151</td></tr>
    <tr><td>Permalink</td><td><a href="https://google.aip.dev/151">google.aip.dev/151</a></td></tr>
    <tr><td>State</td><td>Approved</td></tr>
    <tr><td>Created</td><td>2019-07-25</td></tr>
    <tr><td>Updated</td><td>2019-07-25</td></tr>
  </table>

  <section id="aip-toc" class="docs-component-sidebar-toc">
    <div class="toc"><span class="toctitle">Contents</span><ul>
<li><a href="#guidance">Guidance</a><ul>
<li><a href="#standard-methods">Standard methods</a></li>
<li><a href="#parallel-operations">Parallel operations</a></li>
<li><a href="#expiration">Expiration</a></li>
<li><a href="#errors">Errors</a></li>
<li><a href="#backwards-compatibility">Backwards compatibility</a></li>
</ul>
</li>
<li><a href="#rationale">Rationale</a><ul>
<li><a href="#validate-only-behavior">Validate-only behavior</a></li>
</ul>
</li>
<li><a href="#changelog">Changelog</a></li>
</ul>
</div>

  </section>

  <section class="docs-component-sidebar-actions">
    <ul>
      <li><a href="https://github.com/aip-dev/google.aip.dev/issues/">File Bug</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/blob/master/aip/general/0151.md">View source</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/edit/master/aip/general/0151.md">Edit this page</a></li>
    </ul>
  </section>
</aside>
<section id="aip-main" class="docs-component-main">
  <section class="section-breadcrumbs">
  <nav
    class="glue-breadcrumbs glue-mod-mt-std glue-mod-mb-std"
    aria-label="You are here."
  >
    <ol class="glue-breadcrumbs__list aip-breadcrumbs">
      <li class="glue-breadcrumbs__item" aria-level="1">
        <a class="glue-breadcrumbs__link" href="/">
          API Improvement Proposals
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item" aria-level="2">
        <a class="glue-breadcrumbs__link" href="/general">
          General AIPs
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item glue-breadcrumbs__item--active"
          aria-level="3">
        Long-running operations
      </li>
    </ol>
  </nav>
</section>
  
  <h4 class="aip-number">AIP-151</h4>
  <h1 id="long-running-operations">Long-running operations</h1>
<p>Occasionally, an API may need to expose a method that takes a significant
amount of time to complete. In these situations, it is often a poor user
experience to simply block while the task runs; rather, it is better to return
some kind of promise to the user and allow the user to check back in later.</p>
<p>The long-running operations pattern is roughly analogous to a <a href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future">Python
Future</a>, or a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Using_promises">Node.js Promise</a>. Essentially, the user is given a token
that can be used to track progress and retrieve the result.</p>
<h2 id="guidance">Guidance</h2>
<p>Individual API methods that might take a significant amount of time to complete
<strong>should</strong> return a <a href="https://github.com/googleapis/googleapis/blob/master/google/longrunning/operations.proto"><code>google.longrunning.Operation</code></a> object instead of the
ultimate response message.</p>
<div class="highlight language-proto"><pre><span></span><code><span class="c1">// Create a book.</span>
<span class="k">rpc</span> <span class="n">CreateBook</span><span class="p">(</span><span class="n">CreateBookRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">google.longrunning.Operation</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">option</span> <span class="p">(</span><span class="n">google.api.http</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">post</span><span class="o">:</span> <span class="s">&quot;/v1/{parent=publishers/*}/books&quot;</span>
    <span class="n">body</span><span class="o">:</span> <span class="s">&quot;book&quot;</span>
  <span class="p">};</span>
  <span class="k">option</span> <span class="p">(</span><span class="n">google.longrunning.operation_info</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">response_type</span><span class="o">:</span> <span class="s">&quot;Book&quot;</span>
    <span class="n">metadata_type</span><span class="o">:</span> <span class="s">&quot;OperationMetadata&quot;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>The response type <strong>must</strong> be <code>google.longrunning.Operation</code>. The <code>Operation</code>
  proto definition <strong>must not</strong> be copied into individual APIs.<ul>
<li>The response <strong>must not</strong> be a streaming response.</li>
</ul>
</li>
<li>The method <strong>must</strong> include a <code>google.longrunning.operation_info</code> annotation,
  which <strong>must</strong> define both response and metadata types.<ul>
<li>The response and metadata types <strong>must</strong> be defined in the file where the
  RPC appears, or a file imported by that file.</li>
<li>If the response and metadata types are defined in another package, the
  fully-qualified message name <strong>must</strong> be used.</li>
<li>The response type <strong>should not</strong> be <code>google.protobuf.Empty</code> (except for
  <a href="/135"><code>Delete</code></a> methods), unless it is certain that response data will
  <em>never</em> be needed. If response data might be added in the future, define an
  empty message for the RPC response and use that.</li>
<li>The metadata type is used to provide information such as progress, partial
  failures, and similar information on each <code>GetOperation</code> call. The metadata
  type <strong>should not</strong> be <code>google.protobuf.Empty</code>, unless it is certain that
  metadata will <em>never</em> be needed. If metadata might be added in the future,
  define an empty message for the RPC metadata and use that.</li>
</ul>
</li>
<li>APIs with messages that return <code>Operation</code> <strong>must</strong> implement the
  <a href="https://github.com/googleapis/googleapis/blob/master/google/longrunning/operations.proto"><code>Operations</code></a> service. Individual APIs <strong>must not</strong> define their own
  interfaces for long-running operations to avoid non-uniformity.</li>
<li>If an RPC supports a <a href="/163">validate-only mode</a>, the response to a
  validation request <strong>must</strong> be one of the following:<ul>
<li>A successful response with an <code>Operation</code> which is already complete, with
  the <code>done</code> field set to <code>true</code>, and a valid (but potentially empty) response
  message in the <code>response</code> field, wrapped in a <code>google.protobuf.Any</code> message.
  The <code>name</code> field <strong>may</strong> be empty, to avoid the service having to maintain
  state for successful validation.</li>
<li>An immediate error response (typically "bad request")</li>
<li>An <code>Operation</code> with the <code>done</code> field set to <code>false</code>, to indicate
  long-running validation. In this case, the <code>name</code> field <strong>must</strong> be set,
  to allow clients to poll the long-running validation operation until it
  has completed. Successful validation <strong>must</strong> eventually be represented by
  an operation with <code>done=true</code> and a valid (but potentially empty) wrapped
  response message in the <code>response</code> field. Unsuccessful validation <strong>must</strong>
  eventually be represented by an operation with <code>done=true</code> and the error
  details provided in the <code>error</code> field.</li>
</ul>
</li>
</ul>
<p><strong>Note:</strong> User expectations can vary on what is considered "a significant
amount of time" depending on what work is being done. A good rule of thumb is
10 seconds.</p>
<h3 id="standard-methods">Standard methods</h3>
<p>APIs <strong>may</strong> return an <code>Operation</code> from the <a href="/133"><code>Create</code></a>,
<a href="/134"><code>Update</code></a>, or <a href="/135"><code>Delete</code></a> standard methods if appropriate. In
this case, the response type in the <code>operation_info</code> annotation <strong>must</strong> be the
standard and expected response type for that standard method.</p>
<p>When creating or deleting a resource with a long-running operation, the
resource <strong>should</strong> be included in <a href="/132"><code>List</code></a> and <a href="/131"><code>Get</code></a>
calls; however, the resource <strong>should</strong> indicate that it is not usable,
generally with a <a href="/216">state enum</a>.</p>
<h3 id="parallel-operations">Parallel operations</h3>
<p>A resource <strong>may</strong> accept multiple operations that will work on it in parallel,
but is not obligated to do so:</p>
<ul>
<li>Resources that accept multiple parallel operations <strong>may</strong> place them in a
  queue rather than work on the operations simultaneously.</li>
<li>Resources that do not permit multiple operations in parallel (denying any
  new operation until the one that is in progress finishes) <strong>must</strong> return
  <code>ABORTED</code> if a user attempts a parallel operation, and include an error
  message explaining the situation.</li>
<li>Resources with <a href="/128">declarative-friendly APIs</a> <strong>may</strong> allow subsequent
  updates to preempt existing operations. In this case, the latest update
  begins processing and previous operations are marked as <code>ABORTED</code> with an
  error message explaining the situation.</li>
</ul>
<h3 id="expiration">Expiration</h3>
<p>APIs <strong>may</strong> allow their operation resources to expire after sufficient time
has elapsed after the operation completed.</p>
<p><strong>Note:</strong> A good rule of thumb for operation expiry is 30 days.</p>
<h3 id="errors">Errors</h3>
<p>Errors that prevent a long-running operation from <em>starting</em> <strong>must</strong> return an
error response (<a href="/193">AIP-193</a>), similar to any other method.</p>
<p>Operations that fail during their execution phase <strong>must</strong> return an
error response (<a href="/193">AIP-193</a>), placed in the <code>Operation.error</code> <a href="https://github.com/googleapis/googleapis/blob/master/google/rpc/status.proto">google.rpc.Status</a>
field.</p>
<p>Non-terminal errors that occur over the course of an operation <strong>may</strong> be placed
in the metadata message and the field(s) <strong>must</strong> be <a href="/193">AIP-193</a> compliant
<a href="https://github.com/googleapis/googleapis/blob/master/google/rpc/status.proto">google.rpc.Status</a>.</p>
<h3 id="backwards-compatibility">Backwards compatibility</h3>
<p>Changing either the <code>response_type</code> or <code>metadata_type</code> of a long-running operation
is a breaking change.</p>
<h2 id="rationale">Rationale</h2>
<h3 id="validate-only-behavior">Validate-only behavior</h3>
<p>The guidance for validate-only responses comes from a tension
between clients, which benefit from "fully formed" operations that can
be treated uniformly, and servers, which don't wish to maintain
additional state for trivial operations. It seems counterintuitive
that just validating a request should generate more state, but a
full operation response that can be fetched later would either
require that or "special" singleton operation IDs. The guidance
provided is a compromise: by returning a "done" operation, clients
can use existing logic to check that the operation has completed
successfully (and therefore doesn't need to be fetched for an
updated status) but server don't need to maintain any additional state.</p>
<!-- prettier-ignore-start -->
<!-- prettier-ignore-end -->

<h2 id="changelog">Changelog</h2>
<ul>
<li><strong>2025-02-04</strong>: Clarified error propagation behavior for failures
  that occur during long-running operations.</li>
<li><strong>2024-04-23</strong>: Provided pattern for validation on RPCs returning
  long-running operations.</li>
<li><strong>2022-05-31</strong>: Added compatibility section.</li>
<li><strong>2020-08-24</strong>: Clarified that responses are not streaming responses.</li>
<li><strong>2020-06-24</strong>: Added guidance for parallel operations.</li>
<li><strong>2020-03-20</strong>: Clarified that both <code>response_type</code> and <code>metadata_type</code> are
  required.</li>
<li><strong>2019-11-22</strong>: Added a short explanation of what <code>metadata_type</code> is for.</li>
<li><strong>2019-09-23</strong>: Added guidance on errors.</li>
<li><strong>2019-08-23</strong>: Added guidance about fully-qualified message names when the
  message name is in another package.</li>
<li><strong>2019-08-01</strong>: Changed the examples from "shelves" to "publishers", to
  present a better example of resource ownership.</li>
</ul>
  <footer>
  Except as otherwise noted, the content of this page is licensed under the
  <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
  Attribution 4.0 License</a>, and code samples are licensed under the
  <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
  <span class="no-print">For details, see <a href="/licensing">content
  licensing</a>.</span>
</footer>
</section>

        </section>
      </main>
      
    </div>
    <script src="//www.gstatic.com/external_hosted/hammerjs/v2_0_2/hammer.min.js"></script>
    <script src="//www.gstatic.com/glue/v22_1/glue-vanilla.min.js"></script>
    <script type="text/javascript">
      const headerElement = document.querySelector('.glue-header');
      if (headerElement) {
        new window.glue.ui.header.Header(headerElement);
      }
    </script>
  </body>
</html>