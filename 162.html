<!DOCTYPE html>
<html lang="en-US" class="glue-flexbox">
  <head>
    <title>AIP-162: Resource Revisions</title>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Google+Sans:400,500|Product+Sans:400&amp;lang=en" rel="stylesheet"></link>
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <link rel="stylesheet" type="text/css" media="screen" href="//www.gstatic.com/glue/v22_1/glue.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=039e59c6">
    <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css?v=039e59c6">
    <script type="text/javascript" src="//code.jquery.com/jquery-3.4.0.min.js"></script>
    <script type="text/javascript" src="//www.gstatic.com/glue/latest/glue-detect.min.js"></script>
    <script type="text/javascript">
      $('html').css('visibility', 'hidden');
      $.when($.ready).then(() => {
        $('html').css('visibility', 'visible');
      });
    </script>
    <script type="text/javascript" src="/assets/js/global.js?v=039e59c6"></script>
    
<script type="text/javascript" src="/assets/js/syntax.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140054909-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-140054909-1');
    </script>
  </head>
  <body>
    <!-- prettier-ignore -->
<header class="glue-header glue-header--single">
  <div class="glue-header__bar glue-header__bar--desktop glue-header__drawer">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- LINK BAR-->
      <div class="glue-header__container glue-header__container--flex-auto">
        <nav class="glue-header__link-bar">
          <ul id="list-1" class="glue-header__list">
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/general" aria-level="1">Browse AIPs</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/news" aria-level="1">News</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/faq" aria-level="1">FAQ</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/contributing" aria-level="1">Contributing</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="https://linter.aip.dev/" target="_blank" aria-level="1">
                    API Linter
                    <svg role="img" class="glue-icon glue-icon--18px">
                      <use xlink:href="/assets/images/glue-icons.svg#open-in-new"></use>
                    </svg>
                  </a>
                </li>
              
            
          </ul>
        </nav>
      </div>
      <!-- CTA-->
      <div class="glue-header__container glue-header__container--cta">
        <div class="glue-header__cta">
        <div class="glue-sitesearch">
          <form method="GET" action="/search">
          <label for="q">Search this site</label>
          <input class="glue-sitesearch__input" type="text" name="q" id="q"
            placeholder="Search AIPs">
          <button type="submit" class="glue-button glue-sitesearch__submit" title="Submit">
            <svg role="img" class="glue-icon glue-icon--24px">
            <use xlink:href="/assets/images/glue-icons.svg#search"></use>
            </svg>
          </button>
          </form>
        </div>
        <a href="https://github.com/aip-dev/google.aip.dev" target="_blank" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile header placeholder -->
  <div class="glue-header__bar glue-header__bar--mobile">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__hamburger glue-header__hamburger--first-tier">
            <div class="glue-header__hamburger-wrapper">
              <button type="button" class="glue-header__drawer-toggle-btn"
                aria-controls="drawer" aria-expanded="false" aria-label="Open the navigation drawer">
                <svg role="img" class="glue-icon glue-icon--24px"><use xlink:href="/assets/images/glue-icons.svg#menu"></use></svg>
              </button>
            </div>
          </div>
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                  <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <!-- SKIP -->
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- CTA -->
      <div class="glue-header__container">
        <div class="glue-header__cta">
        <a href="https://github.com/aip-dev/google.aip.dev" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <div class="glue-header__drawer-backdrop"></div>
</header>
    <div class="glue-page">
      
      <main role="main" id="page-content">
        
<nav id="aip-nav" class="docs-component-nav">
  <ul class="nav-list">
    <li class="nav-item nav-item-header">AIPs by Scope</li>
    <li class="nav-item">
      <a href="/general">General</a>
    </li>
    <li class="nav-item">
      <a href="/cloud">Google Cloud Platform</a>
    </li>
    <li class="nav-item">
      <a href="/auth">Auth</a>
    </li>
    <li class="nav-item">
      <a href="/client-libraries">Client libraries</a>
    </li>
    <li class="nav-item">
      <a href="/apps">Workspace</a>
    </li>
    <li class="nav-item">
      <a href="/aog">Actions on Google</a>
    </li>
    <li class="nav-item nav-item-header">AIPs</li>
    <li class="nav-item">
      <a href="/1">
        <span class="aip-number">1</span>
        AIP Purpose and Guidelines
      </a>
    </li>
    <li class="nav-item">
      <a href="/2">
        <span class="aip-number">2</span>
        AIP Numbering
      </a>
    </li>
    <li class="nav-item">
      <a href="/3">
        <span class="aip-number">3</span>
        AIP Versioning
      </a>
    </li>
    <li class="nav-item">
      <a href="/8">
        <span class="aip-number">8</span>
        AIP Style and Guidance
      </a>
    </li>
    <li class="nav-item">
      <a href="/9">
        <span class="aip-number">9</span>
        Glossary
      </a>
    </li>
    <li class="nav-item">
      <a href="/100">
        <span class="aip-number">100</span>
        API Design Review FAQ
      </a>
    </li>
    <li class="nav-item">
      <a href="/111">
        <span class="aip-number">111</span>
        Planes
      </a>
    </li>
    <li class="nav-item">
      <a href="/121">
        <span class="aip-number">121</span>
        Resource-oriented design
      </a>
    </li>
    <li class="nav-item">
      <a href="/122">
        <span class="aip-number">122</span>
        Resource names
      </a>
    </li>
    <li class="nav-item">
      <a href="/123">
        <span class="aip-number">123</span>
        Resource types
      </a>
    </li>
    <li class="nav-item">
      <a href="/124">
        <span class="aip-number">124</span>
        Resource association
      </a>
    </li>
    <li class="nav-item">
      <a href="/126">
        <span class="aip-number">126</span>
        Enumerations
      </a>
    </li>
    <li class="nav-item">
      <a href="/127">
        <span class="aip-number">127</span>
        HTTP and gRPC Transcoding
      </a>
    </li>
    <li class="nav-item">
      <a href="/128">
        <span class="aip-number">128</span>
        Declarative-friendly interfaces
      </a>
    </li>
    <li class="nav-item">
      <a href="/129">
        <span class="aip-number">129</span>
        Server-Modified Values and Defaults
      </a>
    </li>
    <li class="nav-item">
      <a href="/130">
        <span class="aip-number">130</span>
        Methods
      </a>
    </li>
    <li class="nav-item">
      <a href="/131">
        <span class="aip-number">131</span>
        Standard methods: Get
      </a>
    </li>
    <li class="nav-item">
      <a href="/132">
        <span class="aip-number">132</span>
        Standard methods: List
      </a>
    </li>
    <li class="nav-item">
      <a href="/133">
        <span class="aip-number">133</span>
        Standard methods: Create
      </a>
    </li>
    <li class="nav-item">
      <a href="/134">
        <span class="aip-number">134</span>
        Standard methods: Update
      </a>
    </li>
    <li class="nav-item">
      <a href="/135">
        <span class="aip-number">135</span>
        Standard methods: Delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/136">
        <span class="aip-number">136</span>
        Custom methods
      </a>
    </li>
    <li class="nav-item">
      <a href="/140">
        <span class="aip-number">140</span>
        Field names
      </a>
    </li>
    <li class="nav-item">
      <a href="/141">
        <span class="aip-number">141</span>
        Quantities
      </a>
    </li>
    <li class="nav-item">
      <a href="/142">
        <span class="aip-number">142</span>
        Time and duration
      </a>
    </li>
    <li class="nav-item">
      <a href="/143">
        <span class="aip-number">143</span>
        Standardized codes
      </a>
    </li>
    <li class="nav-item">
      <a href="/144">
        <span class="aip-number">144</span>
        Repeated fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/145">
        <span class="aip-number">145</span>
        Ranges
      </a>
    </li>
    <li class="nav-item">
      <a href="/146">
        <span class="aip-number">146</span>
        Generic fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/147">
        <span class="aip-number">147</span>
        Sensitive fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/148">
        <span class="aip-number">148</span>
        Standard fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/149">
        <span class="aip-number">149</span>
        Unset field values
      </a>
    </li>
    <li class="nav-item">
      <a href="/151">
        <span class="aip-number">151</span>
        Long-running operations
      </a>
    </li>
    <li class="nav-item">
      <a href="/152">
        <span class="aip-number">152</span>
        Jobs
      </a>
    </li>
    <li class="nav-item">
      <a href="/153">
        <span class="aip-number">153</span>
        Import and export
      </a>
    </li>
    <li class="nav-item">
      <a href="/154">
        <span class="aip-number">154</span>
        Resource freshness validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/155">
        <span class="aip-number">155</span>
        Request identification
      </a>
    </li>
    <li class="nav-item">
      <a href="/156">
        <span class="aip-number">156</span>
        Singleton resources
      </a>
    </li>
    <li class="nav-item">
      <a href="/157">
        <span class="aip-number">157</span>
        Partial responses
      </a>
    </li>
    <li class="nav-item">
      <a href="/158">
        <span class="aip-number">158</span>
        Pagination
      </a>
    </li>
    <li class="nav-item">
      <a href="/159">
        <span class="aip-number">159</span>
        Reading across collections
      </a>
    </li>
    <li class="nav-item">
      <a href="/160">
        <span class="aip-number">160</span>
        Filtering
      </a>
    </li>
    <li class="nav-item">
      <a href="/161">
        <span class="aip-number">161</span>
        Field masks
      </a>
    </li>
    <li class="nav-item nav-item-active">
      <a href="/162">
        <span class="aip-number">162</span>
        Resource Revisions
      </a>
    </li>
    <li class="nav-item">
      <a href="/163">
        <span class="aip-number">163</span>
        Change validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/164">
        <span class="aip-number">164</span>
        Soft delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/165">
        <span class="aip-number">165</span>
        Criteria-based delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/180">
        <span class="aip-number">180</span>
        Backwards compatibility
      </a>
    </li>
    <li class="nav-item">
      <a href="/181">
        <span class="aip-number">181</span>
        Stability levels
      </a>
    </li>
    <li class="nav-item">
      <a href="/182">
        <span class="aip-number">182</span>
        External software dependencies
      </a>
    </li>
    <li class="nav-item">
      <a href="/185">
        <span class="aip-number">185</span>
        API Versioning
      </a>
    </li>
    <li class="nav-item">
      <a href="/190">
        <span class="aip-number">190</span>
        Naming conventions
      </a>
    </li>
    <li class="nav-item">
      <a href="/191">
        <span class="aip-number">191</span>
        File and directory structure
      </a>
    </li>
    <li class="nav-item">
      <a href="/192">
        <span class="aip-number">192</span>
        Documentation
      </a>
    </li>
    <li class="nav-item">
      <a href="/193">
        <span class="aip-number">193</span>
        Errors
      </a>
    </li>
    <li class="nav-item">
      <a href="/194">
        <span class="aip-number">194</span>
        Automatic retry configuration
      </a>
    </li>
    <li class="nav-item">
      <a href="/200">
        <span class="aip-number">200</span>
        Precedent
      </a>
    </li>
    <li class="nav-item">
      <a href="/202">
        <span class="aip-number">202</span>
        Fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/203">
        <span class="aip-number">203</span>
        Field behavior documentation
      </a>
    </li>
    <li class="nav-item">
      <a href="/205">
        <span class="aip-number">205</span>
        Beta-blocking changes
      </a>
    </li>
    <li class="nav-item">
      <a href="/210">
        <span class="aip-number">210</span>
        Unicode
      </a>
    </li>
    <li class="nav-item">
      <a href="/211">
        <span class="aip-number">211</span>
        Authorization checks
      </a>
    </li>
    <li class="nav-item">
      <a href="/213">
        <span class="aip-number">213</span>
        Common components
      </a>
    </li>
    <li class="nav-item">
      <a href="/214">
        <span class="aip-number">214</span>
        Resource expiration
      </a>
    </li>
    <li class="nav-item">
      <a href="/215">
        <span class="aip-number">215</span>
        API-specific protos
      </a>
    </li>
    <li class="nav-item">
      <a href="/216">
        <span class="aip-number">216</span>
        States
      </a>
    </li>
    <li class="nav-item">
      <a href="/217">
        <span class="aip-number">217</span>
        Unreachable resources
      </a>
    </li>
    <li class="nav-item">
      <a href="/231">
        <span class="aip-number">231</span>
        Batch methods: Get
      </a>
    </li>
    <li class="nav-item">
      <a href="/233">
        <span class="aip-number">233</span>
        Batch methods: Create
      </a>
    </li>
    <li class="nav-item">
      <a href="/234">
        <span class="aip-number">234</span>
        Batch methods: Update
      </a>
    </li>
    <li class="nav-item">
      <a href="/235">
        <span class="aip-number">235</span>
        Batch methods: Delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/236">
        <span class="aip-number">236</span>
        Policy preview
      </a>
    </li>
    </ul>
</nav>
<section id="jump-content">
          
<aside id="aip-sidebar" class="docs-component-sidebar">
  <table id="aip-summary">
    <tr><th colspan="2">Resource Revisions</th></tr>
    <tr><td>Number</td><td>162</td></tr>
    <tr><td>Permalink</td><td><a href="https://google.aip.dev/162">google.aip.dev/162</a></td></tr>
    <tr><td>State</td><td>Draft</td></tr>
    <tr><td>Created</td><td>2019-09-17</td></tr>
    <tr><td>Updated</td><td>2019-09-17</td></tr>
  </table>

  <section id="aip-toc" class="docs-component-sidebar-toc">
    <div class="toc"><span class="toctitle">Contents</span><ul>
<li><a href="#guidance">Guidance</a><ul>
<li><a href="#creating-revisions">Creating Revisions</a></li>
<li><a href="#resource-names-for-revisions">Resource names for revisions</a></li>
<li><a href="#server-specified-aliases">Server-specified Aliases</a></li>
<li><a href="#user-specified-aliases">User-Specified Aliases</a></li>
<li><a href="#rollback">Rollback</a></li>
<li><a href="#child-resources">Child resources</a></li>
<li><a href="#standard-methods">Standard methods</a></li>
</ul>
</li>
<li><a href="#rationale">Rationale</a><ul>
<li><a href="#abstract-revisions-as-nested-collection">Abstract revisions as nested collection</a></li>
<li><a href="#tagging-to-aliases">Tagging to Aliases</a></li>
<li><a href="#output-only-resource-configuration">Output only resource configuration</a></li>
</ul>
</li>
<li><a href="#history">History</a><ul>
<li><a href="#switching-from-a-collection-extension-to-a-subcollection">Switching from a collection extension to a subcollection</a></li>
<li><a href="#using-resource-id-instead-of-tag">Using resource ID instead of tag</a></li>
</ul>
</li>
<li><a href="#changelog">Changelog</a></li>
</ul>
</div>

  </section>

  <section class="docs-component-sidebar-actions">
    <ul>
      <li><a href="https://github.com/aip-dev/google.aip.dev/issues/">File Bug</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/blob/master/aip/general/0162.md">View source</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/edit/master/aip/general/0162.md">Edit this page</a></li>
    </ul>
  </section>
</aside>
<section id="aip-main" class="docs-component-main">
  <section class="section-breadcrumbs">
  <nav
    class="glue-breadcrumbs glue-mod-mt-std glue-mod-mb-std"
    aria-label="You are here."
  >
    <ol class="glue-breadcrumbs__list aip-breadcrumbs">
      <li class="glue-breadcrumbs__item" aria-level="1">
        <a class="glue-breadcrumbs__link" href="/">
          API Improvement Proposals
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item" aria-level="2">
        <a class="glue-breadcrumbs__link" href="/general">
          General AIPs
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item glue-breadcrumbs__item--active"
          aria-level="3">
        Resource Revisions
      </li>
    </ol>
  </nav>
</section>
  <p id="aip-state-banner" class="callout warning">
  This AIP is currently a draft. This means that it is being actively debated
  and discussed, and it may change in non-trivial ways.
</p>
  <h4 class="aip-number">AIP-162</h4>
  <h1 id="resource-revisions">Resource Revisions</h1>
<p>Some APIs need to have resources with a revision history, where users can
reason about the state of the resource over time. There are several reasons for
this:</p>
<ul>
<li>Users may want to be able to roll back to a previous revision, or diff
  against a previous revision.</li>
<li>An API may create data which is derived in some way from a resource at a
  given point in time. In these cases, it may be desirable to snapshot the
  resource for reference later.</li>
</ul>
<p><strong>Note:</strong> We use the word <em>revision</em> to refer to a historical reference for a
particular resource, and intentionally avoid the term <em>version</em>, which refers
to the version of an API as a whole.</p>
<h2 id="guidance">Guidance</h2>
<p>APIs <strong>may</strong> store a revision history for a resource. Examples of when it is
useful include:</p>
<ul>
<li>When it is valuable to expose older versions of a resource via an API. This
  can avoid the overhead of the customers having to write their own API to store
  and enable retrieval of revisions.</li>
<li>Other resources depend on different revisions of a resource.</li>
<li>There is a need to represent the change of a resource over time.</li>
</ul>
<p>APIs implementing resources with a revision history <strong>should</strong> abstract resource
revisions as nested collection of the resource. Sometimes, the revisions
collection can be a top level collection, exceptions include:</p>
<ul>
<li>If resource revisions are meant to have longer lifespan than the parent
resource. In other words, resource revisions exist after resource deletion.</li>
</ul>
<div class="highlight language-proto"><pre><span></span><code><span class="kd">message</span> <span class="nc">BookRevision</span> <span class="p">{</span>
  <span class="c1">// The name of the book revision.</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// The snapshot of the book</span>
  <span class="n">Book</span> <span class="na">snapshot</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="p">[(</span><span class="n">google.api.field_behavior</span><span class="p">)</span> <span class="o">=</span> <span class="n">OUTPUT_ONLY</span><span class="p">];</span>

  <span class="c1">// The timestamp that the revision was created.</span>
  <span class="n">google.protobuf.Timestamp</span> <span class="na">create_time</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="p">[(</span><span class="n">google.api.field_behavior</span><span class="p">)</span> <span class="o">=</span> <span class="n">OUTPUT_ONLY</span><span class="p">];</span>

  <span class="c1">// Other revision IDs that share the same snapshot.</span>
  <span class="k">repeated</span> <span class="kt">string</span> <span class="na">alternate_ids</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="p">[(</span><span class="n">google.api.field_behavior</span><span class="p">)</span> <span class="o">=</span> <span class="n">OUTPUT_ONLY</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>The <code>message</code> <strong>must</strong> be annotated as a resource (<a href="/123">AIP-123</a>).</li>
<li>The <code>message</code> name <strong>must</strong> be named <code>{ResourceType}Revision</code>.</li>
<li>The resource revision <strong>must</strong> contain a field with a message type of the
  parent resource, with a field name of <code>snapshot</code>.<ul>
<li>The value of <code>snapshot</code> <strong>must</strong> be the configuration of the parent
  at the point in time the revision was created.</li>
</ul>
</li>
<li>The resource revision <strong>must</strong> contain a <code>create_time</code> field (see <a href="/142">AIP-142</a>).</li>
<li>The resource revision <strong>may</strong> contain a repeated field <code>alternate_ids</code>, which would
  contain a list of resource IDs that the revision is also known by (e.g. <code>latest</code>)</li>
</ul>
<h3 id="creating-revisions">Creating Revisions</h3>
<p>Depending on the resource, different APIs may have different strategies for</p>
<ul>
<li>Create a new revision any time that there is a change to the parent resource</li>
<li>Create a new revision when important system state changes</li>
<li>Create a new revision when specifically requested</li>
</ul>
<p>APIs <strong>may</strong> use any of these strategies. APIs <strong>must</strong>
document their revision creation strategy.</p>
<h3 id="resource-names-for-revisions">Resource names for revisions</h3>
<p>When referring to specific revision of a resource, the subcollection name
<strong>must</strong> be named <code>revisions</code>. Resource revisions have names with the format
<code>{resource_name}/revisions/{revision_id}</code>. For example:
<div class="highlight language-None"><pre><span></span><code>publishers/123/books/les-miserables/revisions/c7cfa2a8
</code></pre></div></p>
<h3 id="server-specified-aliases">Server-specified Aliases</h3>
<p>Services <strong>may</strong> reserve specific IDs to be <a href="/122#resource-id-aliases">aliases</a> (e.g.
<code>latest</code>). These are read-only and managed by the service.</p>
<div class="highlight language-None"><pre><span></span><code>GET /v1/publishers/{publisher}/books/{book}/revisions/{revision_id}
</code></pre></div>
<ul>
<li>If a <code>latest</code> ID exists, it <strong>must</strong> represent the most recently created
revision. The content of <code>publishers/{publisher}/books/{book}/revisions/latest</code>
and <code>publishers/{publisher}/books/{book}</code> can differ, as the latest revision may
be different from the current state of the resource.</li>
</ul>
<h3 id="user-specified-aliases">User-Specified Aliases</h3>
<p>APIs <strong>may</strong> provide a mechanism for users to assign an <a href="/122#resource-id-aliases">alias</a> ID to an
existing revision with a custom method "alias":</p>
<div class="highlight language-proto"><pre><span></span><code><span class="k">rpc</span> <span class="n">AliasBookRevision</span><span class="p">(</span><span class="n">AliasBookRevisionRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">Book</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">option</span> <span class="p">(</span><span class="n">google.api.http</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">post</span><span class="o">:</span> <span class="s">&quot;/v1/{name=publishers/*/books/*/revisions/*}:alias&quot;</span>
    <span class="n">body</span><span class="o">:</span> <span class="s">&quot;*&quot;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight language-proto"><pre><span></span><code><span class="kd">message</span> <span class="nc">AliasBookRevisionRequest</span> <span class="p">{</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">google.api.field_behavior</span><span class="p">)</span> <span class="o">=</span> <span class="n">REQUIRED</span><span class="p">,</span>
    <span class="p">(</span><span class="n">google.api.resource_reference</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">type</span><span class="o">:</span> <span class="s">&quot;library.googleapis.com/BookRevision&quot;</span>
    <span class="p">}];</span>

  <span class="c1">// The ID of the revision to alias to, e.g. `CURRENT` or a semantic</span>
  <span class="c1">// version.</span>
  <span class="kt">string</span> <span class="na">alias_id</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">[(</span><span class="n">google.api.field_behavior</span><span class="p">)</span> <span class="o">=</span> <span class="n">REQUIRED</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>The request message <strong>must</strong> have a <code>name</code> field:<ul>
<li>The field <strong>must</strong> be <a href="/203">annotated as required</a>.</li>
<li>The field <strong>must</strong> identify the <a href="/123">resource type</a> that it
  references.</li>
</ul>
</li>
<li>The request message <strong>must</strong> have a <code>alias_id</code> field:<ul>
<li>The field <strong>must</strong> be <a href="/203">annotated as required</a>.</li>
</ul>
</li>
<li>If the user calls the method with an existing <code>alias_id</code>, the request <strong>must</strong>
  succeed and the alias will be updated to refer to the provided revision. This
  allows users to write code against a specific alias (e.g. <code>published</code>) and the
  revision can change with no code change.</li>
</ul>
<h3 id="rollback">Rollback</h3>
<p>A common use case for a resource with a revision history is the ability to roll
back to a given revision. APIs <strong>should</strong> handle this with a <code>Rollback</code> custom
method:</p>
<div class="highlight language-proto"><pre><span></span><code><span class="k">rpc</span> <span class="n">RollbackBook</span><span class="p">(</span><span class="n">RollbackBookRequest</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">BookRevision</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">option</span> <span class="p">(</span><span class="n">google.api.http</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">post</span><span class="o">:</span> <span class="s">&quot;/v1/{name=publishers/*/books/*/revisions/*}:rollback&quot;</span>
    <span class="n">body</span><span class="o">:</span> <span class="s">&quot;*&quot;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>The method <strong>must</strong> use the <code>POST</code> HTTP verb.</li>
<li>The method <strong>should</strong> return a resource revision.</li>
</ul>
<div class="highlight language-proto"><pre><span></span><code><span class="kd">message</span> <span class="nc">RollbackBookRequest</span> <span class="p">{</span>
  <span class="c1">// The revision that the book should be rolled back to.</span>
  <span class="kt">string</span> <span class="na">name</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">google.api.field_behavior</span><span class="p">)</span> <span class="o">=</span> <span class="n">REQUIRED</span><span class="p">,</span>
    <span class="p">(</span><span class="n">google.api.resource_reference</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">type</span><span class="o">:</span> <span class="s">&quot;library.googleapis.com/BookRevision&quot;</span>
    <span class="p">}];</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>The request message <strong>must</strong> have a <code>name</code> field, referring to the resource
  revision whose configuration the resource should be rolled back to.<ul>
<li>The field <strong>must</strong> be <a href="/203">annotated as required</a>.</li>
<li>The field <strong>must</strong> identify the <a href="/123">resource type</a> that it
  references.</li>
</ul>
</li>
</ul>
<h3 id="child-resources">Child resources</h3>
<p>Resources with a revision history <strong>may</strong> have child resources. If they do,
there are two potential variants:</p>
<ul>
<li>Child resources where each child resource is a child of the parent resource
  as a whole.</li>
<li>Child resources where each child resource is a child of <em>a single revision
  of</em> the parent resource.</li>
</ul>
<p>APIs <strong>should not</strong> include multiple levels of resources with revisions, as
this quickly becomes difficult to reason about.</p>
<h3 id="standard-methods">Standard methods</h3>
<p>Any standard methods <strong>must</strong> implement the corresponding AIPs (<a href="/131">AIP-131</a>,
<a href="/132">AIP-132</a>, <a href="/133">AIP-133</a>, <a href="/134">AIP-134</a>, <a href="/135">AIP-135</a>), with the following additional behaviors:</p>
<ul>
<li>List methods: By default, revisions in the list response <strong>must</strong> be ordered
  in reverse chronological order. User can supply <code>order_by</code> to override the
  default behavior.</li>
<li>If the revision supports aliasing, a delete method with the resource name
  of the alias (e.g. <code>revisions/1.0.2</code>) <strong>must</strong> remove the alias instead of
  deleting the resource.</li>
</ul>
<p>As revisions are nested under the resource, also see <a href="/135#cascading-delete">cascading delete</a>.</p>
<h2 id="rationale">Rationale</h2>
<h3 id="abstract-revisions-as-nested-collection">Abstract revisions as nested collection</h3>
<p>Revisions being resources under nested collection make revisions a first class
citizen.</p>
<ul>
<li>Revisions can offer standard get, list, and delete methods.</li>
<li>It retains the flexibility of extending new fields to revision in addition to
  the resource message.</li>
</ul>
<h3 id="tagging-to-aliases">Tagging to Aliases</h3>
<p>Previously, a concept of <code>tag</code> existed. This concept was redundant with that of
an <a href="/122#resource-id-aliases">alias</a>, and the terms were consolidated to reduce complexity in the AIPs.</p>
<h3 id="output-only-resource-configuration">Output only resource configuration</h3>
<p>Although it was an option to have the revision take in the resource
configuration as part of the create method, doing so would have allowed users to
submit resource configuration for a revision that the resource was never in.</p>
<p><code>OUTPUT_ONLY</code> and requiring that a created revision represents the resource at
current point in time eliminates that issue.</p>
<h2 id="history">History</h2>
<h3 id="switching-from-a-collection-extension-to-a-subcollection">Switching from a collection extension to a subcollection</h3>
<p>In 2023-09, revisions are abstracted as a nested resource collection. Prior to
this, revisions are more like extension of an existing resource by using <code>@</code>
symbol. List and delete revisions were custom methods on the resource
collection. A single Get method was used to retrieve either the resource
revision, or the resource.</p>
<p>Its primary advantage was allowing a resource reference to seamlessly refer to
a resource, or its revision.</p>
<p>It also had several disadvantages:</p>
<ul>
<li>List revisions is a custom method (:listRevisions) on the resource collection</li>
<li>Delete revision is a custom method on the resource collection</li>
<li>Not visible in API discovery doc</li>
<li>Resource ID cannot use <code>@</code></li>
</ul>
<p>The guidance was modified ultimately to enable revisions to behave like a
resource, which reduces the users cognitive load and allows resource-oriented
clients to easily list, get, create, and update revisions.</p>
<h3 id="using-resource-id-instead-of-tag">Using resource ID instead of tag</h3>
<p>In the previous design, revisions had a separate identifer for a revision known
as a <code>tag</code>, that would live in a revision.</p>
<p>Tags were effectively a shadow resource ID, requiring methods to create, get and
filter revisions based on the value of the tag.</p>
<p>By consolidating the concept of a tag into the revision ID, the user no longer
needs to be familiar with a second set of retrieval and identifier methods.</p>
<h2 id="changelog">Changelog</h2>
<ul>
<li><strong>2023-09-01</strong>: AIP was updated to be a sub-collection.</li>
<li><strong>2021-04-27</strong>: Added guidance on returning the resource from Delete Revision.</li>
</ul>
  <footer>
  Except as otherwise noted, the content of this page is licensed under the
  <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
  Attribution 4.0 License</a>, and code samples are licensed under the
  <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
  <span class="no-print">For details, see <a href="/licensing">content
  licensing</a>.</span>
</footer>
</section>

        </section>
      </main>
      
    </div>
    <script src="//www.gstatic.com/external_hosted/hammerjs/v2_0_2/hammer.min.js"></script>
    <script src="//www.gstatic.com/glue/v22_1/glue-vanilla.min.js"></script>
    <script type="text/javascript">
      const headerElement = document.querySelector('.glue-header');
      if (headerElement) {
        new window.glue.ui.header.Header(headerElement);
      }
    </script>
  </body>
</html>