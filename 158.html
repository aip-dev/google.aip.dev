<!DOCTYPE html>
<html lang="en-US" class="glue-flexbox">
  <head>
    <title>AIP-158: Pagination</title>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Google+Sans:400,500|Product+Sans:400&amp;lang=en" rel="stylesheet"></link>
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <link rel="stylesheet" type="text/css" media="screen" href="//www.gstatic.com/glue/v22_1/glue.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=631cebbe">
    <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css?v=631cebbe">
    <script type="text/javascript" src="//code.jquery.com/jquery-3.4.0.min.js"></script>
    <script type="text/javascript" src="//www.gstatic.com/glue/latest/glue-detect.min.js"></script>
    <script type="text/javascript">
      $('html').css('visibility', 'hidden');
      $.when($.ready).then(() => {
        $('html').css('visibility', 'visible');
      });
    </script>
    <script type="text/javascript" src="/assets/js/global.js?v=631cebbe"></script>
    
<script type="text/javascript" src="/assets/js/syntax.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140054909-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-140054909-1');
    </script>
  </head>
  <body>
    <!-- prettier-ignore -->
<header class="glue-header glue-header--single">
  <div class="glue-header__bar glue-header__bar--desktop glue-header__drawer">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- LINK BAR-->
      <div class="glue-header__container glue-header__container--flex-auto">
        <nav class="glue-header__link-bar">
          <ul id="list-1" class="glue-header__list">
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/general" aria-level="1">Browse AIPs</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/news" aria-level="1">News</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/faq" aria-level="1">FAQ</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/contributing" aria-level="1">Contributing</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="https://linter.aip.dev/" target="_blank" aria-level="1">
                    API Linter
                    <svg role="img" class="glue-icon glue-icon--18px">
                      <use xlink:href="/assets/images/glue-icons.svg#open-in-new"></use>
                    </svg>
                  </a>
                </li>
              
            
          </ul>
        </nav>
      </div>
      <!-- CTA-->
      <div class="glue-header__container glue-header__container--cta">
        <div class="glue-header__cta">
        <div class="glue-sitesearch">
          <form method="GET" action="/search">
          <label for="q">Search this site</label>
          <input class="glue-sitesearch__input" type="text" name="q" id="q"
            placeholder="Search AIPs">
          <button type="submit" class="glue-button glue-sitesearch__submit" title="Submit">
            <svg role="img" class="glue-icon glue-icon--24px">
            <use xlink:href="/assets/images/glue-icons.svg#search"></use>
            </svg>
          </button>
          </form>
        </div>
        <a href="https://github.com/aip-dev/google.aip.dev" target="_blank" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile header placeholder -->
  <div class="glue-header__bar glue-header__bar--mobile">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__hamburger glue-header__hamburger--first-tier">
            <div class="glue-header__hamburger-wrapper">
              <button type="button" class="glue-header__drawer-toggle-btn"
                aria-controls="drawer" aria-expanded="false" aria-label="Open the navigation drawer">
                <svg role="img" class="glue-icon glue-icon--24px"><use xlink:href="/assets/images/glue-icons.svg#menu"></use></svg>
              </button>
            </div>
          </div>
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                  <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <!-- SKIP -->
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- CTA -->
      <div class="glue-header__container">
        <div class="glue-header__cta">
        <a href="https://github.com/aip-dev/google.aip.dev" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <div class="glue-header__drawer-backdrop"></div>
</header>
    <div class="glue-page">
      
      <main role="main" id="page-content">
        
<nav id="aip-nav" class="docs-component-nav">
  <ul class="nav-list">
    <li class="nav-item nav-item-header">AIPs by Scope</li>
    <li class="nav-item">
      <a href="/general">General</a>
    </li>
    <li class="nav-item">
      <a href="/cloud">Google Cloud Platform</a>
    </li>
    <li class="nav-item">
      <a href="/auth">Auth</a>
    </li>
    <li class="nav-item">
      <a href="/client-libraries">Client libraries</a>
    </li>
    <li class="nav-item">
      <a href="/apps">Workspace</a>
    </li>
    <li class="nav-item">
      <a href="/aog">Actions on Google</a>
    </li>
    <li class="nav-item nav-item-header">AIPs</li>
    <li class="nav-item">
      <a href="/1">
        <span class="aip-number">1</span>
        AIP Purpose and Guidelines
      </a>
    </li>
    <li class="nav-item">
      <a href="/2">
        <span class="aip-number">2</span>
        AIP Numbering
      </a>
    </li>
    <li class="nav-item">
      <a href="/3">
        <span class="aip-number">3</span>
        AIP Versioning
      </a>
    </li>
    <li class="nav-item">
      <a href="/8">
        <span class="aip-number">8</span>
        AIP Style and Guidance
      </a>
    </li>
    <li class="nav-item">
      <a href="/9">
        <span class="aip-number">9</span>
        Glossary
      </a>
    </li>
    <li class="nav-item">
      <a href="/100">
        <span class="aip-number">100</span>
        API Design Review FAQ
      </a>
    </li>
    <li class="nav-item">
      <a href="/111">
        <span class="aip-number">111</span>
        Planes
      </a>
    </li>
    <li class="nav-item">
      <a href="/121">
        <span class="aip-number">121</span>
        Resource-oriented design
      </a>
    </li>
    <li class="nav-item">
      <a href="/122">
        <span class="aip-number">122</span>
        Resource names
      </a>
    </li>
    <li class="nav-item">
      <a href="/123">
        <span class="aip-number">123</span>
        Resource types
      </a>
    </li>
    <li class="nav-item">
      <a href="/124">
        <span class="aip-number">124</span>
        Resource association
      </a>
    </li>
    <li class="nav-item">
      <a href="/126">
        <span class="aip-number">126</span>
        Enumerations
      </a>
    </li>
    <li class="nav-item">
      <a href="/127">
        <span class="aip-number">127</span>
        HTTP and gRPC Transcoding
      </a>
    </li>
    <li class="nav-item">
      <a href="/128">
        <span class="aip-number">128</span>
        Declarative-friendly interfaces
      </a>
    </li>
    <li class="nav-item">
      <a href="/129">
        <span class="aip-number">129</span>
        Server-Modified Values and Defaults
      </a>
    </li>
    <li class="nav-item">
      <a href="/130">
        <span class="aip-number">130</span>
        Methods
      </a>
    </li>
    <li class="nav-item">
      <a href="/131">
        <span class="aip-number">131</span>
        Standard methods: Get
      </a>
    </li>
    <li class="nav-item">
      <a href="/132">
        <span class="aip-number">132</span>
        Standard methods: List
      </a>
    </li>
    <li class="nav-item">
      <a href="/133">
        <span class="aip-number">133</span>
        Standard methods: Create
      </a>
    </li>
    <li class="nav-item">
      <a href="/134">
        <span class="aip-number">134</span>
        Standard methods: Update
      </a>
    </li>
    <li class="nav-item">
      <a href="/135">
        <span class="aip-number">135</span>
        Standard methods: Delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/136">
        <span class="aip-number">136</span>
        Custom methods
      </a>
    </li>
    <li class="nav-item">
      <a href="/140">
        <span class="aip-number">140</span>
        Field names
      </a>
    </li>
    <li class="nav-item">
      <a href="/141">
        <span class="aip-number">141</span>
        Quantities
      </a>
    </li>
    <li class="nav-item">
      <a href="/142">
        <span class="aip-number">142</span>
        Time and duration
      </a>
    </li>
    <li class="nav-item">
      <a href="/143">
        <span class="aip-number">143</span>
        Standardized codes
      </a>
    </li>
    <li class="nav-item">
      <a href="/144">
        <span class="aip-number">144</span>
        Repeated fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/145">
        <span class="aip-number">145</span>
        Ranges
      </a>
    </li>
    <li class="nav-item">
      <a href="/146">
        <span class="aip-number">146</span>
        Generic fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/147">
        <span class="aip-number">147</span>
        Sensitive fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/148">
        <span class="aip-number">148</span>
        Standard fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/149">
        <span class="aip-number">149</span>
        Unset field values
      </a>
    </li>
    <li class="nav-item">
      <a href="/151">
        <span class="aip-number">151</span>
        Long-running operations
      </a>
    </li>
    <li class="nav-item">
      <a href="/152">
        <span class="aip-number">152</span>
        Jobs
      </a>
    </li>
    <li class="nav-item">
      <a href="/153">
        <span class="aip-number">153</span>
        Import and export
      </a>
    </li>
    <li class="nav-item">
      <a href="/154">
        <span class="aip-number">154</span>
        Resource freshness validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/155">
        <span class="aip-number">155</span>
        Request identification
      </a>
    </li>
    <li class="nav-item">
      <a href="/156">
        <span class="aip-number">156</span>
        Singleton resources
      </a>
    </li>
    <li class="nav-item">
      <a href="/157">
        <span class="aip-number">157</span>
        Partial responses
      </a>
    </li>
    <li class="nav-item nav-item-active">
      <a href="/158">
        <span class="aip-number">158</span>
        Pagination
      </a>
    </li>
    <li class="nav-item">
      <a href="/159">
        <span class="aip-number">159</span>
        Reading across collections
      </a>
    </li>
    <li class="nav-item">
      <a href="/160">
        <span class="aip-number">160</span>
        Filtering
      </a>
    </li>
    <li class="nav-item">
      <a href="/161">
        <span class="aip-number">161</span>
        Field masks
      </a>
    </li>
    <li class="nav-item">
      <a href="/162">
        <span class="aip-number">162</span>
        Resource Revisions
      </a>
    </li>
    <li class="nav-item">
      <a href="/163">
        <span class="aip-number">163</span>
        Change validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/164">
        <span class="aip-number">164</span>
        Soft delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/165">
        <span class="aip-number">165</span>
        Criteria-based delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/180">
        <span class="aip-number">180</span>
        Backwards compatibility
      </a>
    </li>
    <li class="nav-item">
      <a href="/181">
        <span class="aip-number">181</span>
        Stability levels
      </a>
    </li>
    <li class="nav-item">
      <a href="/182">
        <span class="aip-number">182</span>
        External software dependencies
      </a>
    </li>
    <li class="nav-item">
      <a href="/185">
        <span class="aip-number">185</span>
        API Versioning
      </a>
    </li>
    <li class="nav-item">
      <a href="/190">
        <span class="aip-number">190</span>
        Naming conventions
      </a>
    </li>
    <li class="nav-item">
      <a href="/191">
        <span class="aip-number">191</span>
        File and directory structure
      </a>
    </li>
    <li class="nav-item">
      <a href="/192">
        <span class="aip-number">192</span>
        Documentation
      </a>
    </li>
    <li class="nav-item">
      <a href="/193">
        <span class="aip-number">193</span>
        Errors
      </a>
    </li>
    <li class="nav-item">
      <a href="/194">
        <span class="aip-number">194</span>
        Automatic retry configuration
      </a>
    </li>
    <li class="nav-item">
      <a href="/200">
        <span class="aip-number">200</span>
        Precedent
      </a>
    </li>
    <li class="nav-item">
      <a href="/202">
        <span class="aip-number">202</span>
        Fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/203">
        <span class="aip-number">203</span>
        Field behavior documentation
      </a>
    </li>
    <li class="nav-item">
      <a href="/205">
        <span class="aip-number">205</span>
        Beta-blocking changes
      </a>
    </li>
    <li class="nav-item">
      <a href="/210">
        <span class="aip-number">210</span>
        Unicode
      </a>
    </li>
    <li class="nav-item">
      <a href="/211">
        <span class="aip-number">211</span>
        Authorization checks
      </a>
    </li>
    <li class="nav-item">
      <a href="/213">
        <span class="aip-number">213</span>
        Common components
      </a>
    </li>
    <li class="nav-item">
      <a href="/214">
        <span class="aip-number">214</span>
        Resource expiration
      </a>
    </li>
    <li class="nav-item">
      <a href="/215">
        <span class="aip-number">215</span>
        API-specific protos
      </a>
    </li>
    <li class="nav-item">
      <a href="/216">
        <span class="aip-number">216</span>
        States
      </a>
    </li>
    <li class="nav-item">
      <a href="/217">
        <span class="aip-number">217</span>
        Unreachable resources
      </a>
    </li>
    <li class="nav-item">
      <a href="/231">
        <span class="aip-number">231</span>
        Batch methods: Get
      </a>
    </li>
    <li class="nav-item">
      <a href="/233">
        <span class="aip-number">233</span>
        Batch methods: Create
      </a>
    </li>
    <li class="nav-item">
      <a href="/234">
        <span class="aip-number">234</span>
        Batch methods: Update
      </a>
    </li>
    <li class="nav-item">
      <a href="/235">
        <span class="aip-number">235</span>
        Batch methods: Delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/236">
        <span class="aip-number">236</span>
        Policy preview
      </a>
    </li>
    </ul>
</nav>
<section id="jump-content">
          
<aside id="aip-sidebar" class="docs-component-sidebar">
  <table id="aip-summary">
    <tr><th colspan="2">Pagination</th></tr>
    <tr><td>Number</td><td>158</td></tr>
    <tr><td>Permalink</td><td><a href="https://google.aip.dev/158">google.aip.dev/158</a></td></tr>
    <tr><td>State</td><td>Approved</td></tr>
    <tr><td>Created</td><td>2019-02-18</td></tr>
    <tr><td>Updated</td><td>2019-02-18</td></tr>
  </table>

  <section id="aip-toc" class="docs-component-sidebar-toc">
    <div class="toc"><span class="toctitle">Contents</span><ul>
<li><a href="#guidance">Guidance</a><ul>
<li><a href="#skipping-results">Skipping results</a></li>
<li><a href="#opacity">Opacity</a></li>
<li><a href="#expiring-page-tokens">Expiring page tokens</a></li>
</ul>
</li>
<li><a href="#backwards-compatibility">Backwards compatibility</a></li>
<li><a href="#rationale">Rationale</a><ul>
<li><a href="#degraded-skip-response">Degraded skip response</a></li>
</ul>
</li>
<li><a href="#changelog">Changelog</a></li>
</ul>
</div>

  </section>

  <section class="docs-component-sidebar-actions">
    <ul>
      <li><a href="https://github.com/aip-dev/google.aip.dev/issues/">File Bug</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/blob/master/aip/general/0158.md">View source</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/edit/master/aip/general/0158.md">Edit this page</a></li>
    </ul>
  </section>
</aside>
<section id="aip-main" class="docs-component-main">
  <section class="section-breadcrumbs">
  <nav
    class="glue-breadcrumbs glue-mod-mt-std glue-mod-mb-std"
    aria-label="You are here."
  >
    <ol class="glue-breadcrumbs__list aip-breadcrumbs">
      <li class="glue-breadcrumbs__item" aria-level="1">
        <a class="glue-breadcrumbs__link" href="/">
          API Improvement Proposals
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item" aria-level="2">
        <a class="glue-breadcrumbs__link" href="/general">
          General AIPs
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item glue-breadcrumbs__item--active"
          aria-level="3">
        Pagination
      </li>
    </ol>
  </nav>
</section>
  
  <h4 class="aip-number">AIP-158</h4>
  <h1 id="pagination">Pagination</h1>
<p>APIs often need to provide collections of data, most commonly in the <a href="/132">List</a>
standard method. However, collections can often be arbitrarily sized, and also
often grow over time, increasing lookup time as well as the size of the
responses being sent over the wire. Therefore, it is important that collections
be paginated.</p>
<h2 id="guidance">Guidance</h2>
<p>RPCs returning collections of data <strong>must</strong> provide pagination <em>at the outset</em>,
as it is a <a href="#backwards-compatibility">backwards-incompatible change</a> to add
pagination to an existing method.</p>
<div class="highlight language-proto"><pre><span></span><code><span class="c1">// The request structure for listing books.</span>
<span class="kd">message</span> <span class="nc">ListBooksRequest</span> <span class="p">{</span>
  <span class="c1">// The parent, which owns this collection of books.</span>
  <span class="c1">// Format: publishers/{publisher}</span>
  <span class="kt">string</span> <span class="na">parent</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">[</span>
    <span class="p">(</span><span class="n">google.api.field_behavior</span><span class="p">)</span> <span class="o">=</span> <span class="n">REQUIRED</span><span class="p">,</span>
    <span class="p">(</span><span class="n">google.api.resource_reference</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
      <span class="n">child_type</span><span class="o">:</span> <span class="s">&quot;library.googleapis.com/Book&quot;</span>
    <span class="p">}];</span>

  <span class="c1">// The maximum number of books to return. The service may return fewer than</span>
  <span class="c1">// this value.</span>
  <span class="c1">// If unspecified, at most 50 books will be returned.</span>
  <span class="c1">// The maximum value is 1000; values above 1000 will be coerced to 1000.</span>
  <span class="kt">int32</span> <span class="na">page_size</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

  <span class="c1">// A page token, received from a previous `ListBooks` call.</span>
  <span class="c1">// Provide this to retrieve the subsequent page.</span>
  <span class="c1">//</span>
  <span class="c1">// When paginating, all other parameters provided to `ListBooks` must match</span>
  <span class="c1">// the call that provided the page token.</span>
  <span class="kt">string</span> <span class="na">page_token</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// The response structure from listing books.</span>
<span class="kd">message</span> <span class="nc">ListBooksResponse</span> <span class="p">{</span>
  <span class="c1">// The books from the specified publisher.</span>
  <span class="k">repeated</span> <span class="n">Book</span> <span class="na">books</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

  <span class="c1">// A token that can be sent as `page_token` to retrieve the next page.</span>
  <span class="c1">// If this field is omitted, there are no subsequent pages.</span>
  <span class="kt">string</span> <span class="na">next_page_token</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<ul>
<li>Request messages for collections <strong>should</strong> define an <code>int32 page_size</code>
  field, allowing users to specify the maximum number of results to return.<ul>
<li>The <code>page_size</code> field <strong>must not</strong> be required.</li>
<li>If the user does not specify <code>page_size</code> (or specifies <code>0</code>), the API
  chooses an appropriate default, which the API <strong>should</strong> document. The API
  <strong>must not</strong> return an error.</li>
<li>If the user specifies <code>page_size</code> greater than the maximum permitted by the
  API, the API <strong>should</strong> coerce down to the maximum permitted page size.</li>
<li>If the user specifies a negative value for <code>page_size</code>, the API <strong>must</strong>
  send an <code>INVALID_ARGUMENT</code> error.</li>
<li>The API <strong>may</strong> return fewer results than the number requested (including
  zero results), even if not at the end of the collection.</li>
</ul>
</li>
<li>Request messages for collections <strong>should</strong> define a <code>string page_token</code>
  field, allowing users to advance to the next page in the collection.<ul>
<li>The <code>page_token</code> field <strong>must not</strong> be required.</li>
<li>If the user changes the <code>page_size</code> in a request for subsequent pages, the
  service <strong>must</strong> honor the new page size.</li>
<li>The user is expected to keep all other arguments to the RPC the same; if
  any arguments are different, the API <strong>should</strong> send an <code>INVALID_ARGUMENT</code>
  error.</li>
</ul>
</li>
<li>The response <strong>must not</strong> be a streaming response.</li>
<li>Response messages for collections <strong>should</strong> define a
  <code>string next_page_token</code> field, providing the user with a page token that may
  be used to retrieve the next page.<ul>
<li>The field containing pagination results <strong>should</strong> be the first field in
  the message and have a field number of <code>1</code>. It <strong>should</strong> be a repeated
  field containing a list of resources constituting a single page of results.</li>
<li>If the end of the collection has been reached, the <code>next_page_token</code> field
  <strong>must</strong> be empty. This is the <em>only</em> way to communicate
  "end-of-collection" to users.</li>
<li>If the end of the collection has not been reached (or if the API can not
  determine in time), the API <strong>must</strong> provide a <code>next_page_token</code>.</li>
</ul>
</li>
<li>Response messages for collections <strong>may</strong> provide an <code>int32 total_size</code>
  field, providing the user with the total number of items in the list.<ul>
<li>This total <strong>may</strong> be an estimate (but the API <strong>should</strong> explicitly
  document that).</li>
</ul>
</li>
</ul>
<h3 id="skipping-results">Skipping results</h3>
<p>The request definition for a paginated operation <strong>may</strong> define an <code>int32 skip</code>
field to allow the user to skip results.</p>
<p>The <code>skip</code> value <strong>must</strong> refer to the number of individual resources to skip,
not the number of pages.</p>
<p>For example:</p>
<ul>
<li>A request with no page token and a <code>skip</code> value of <code>30</code> returns a single page
  of results starting with the 31st result.</li>
<li>A request with a page token corresponding to the 51st result (because the
  first 50 results were returned on the first page) and a <code>skip</code> value of <code>30</code>
  returns a single page of results starting with the 81st result.</li>
</ul>
<p>If a <code>skip</code> value is provided that cannot be fulfilled e.g. due to latency of
querying a massive data set, the response <strong>must</strong> be <code>200 OK</code> with an empty
result set. If it is <em>known</em> to put the cursor beyond the total size of the
collection, the response <strong>must not</strong> include a <code>next_page_token</code>.</p>
<h3 id="opacity">Opacity</h3>
<p>Page tokens provided by APIs <strong>must</strong> be opaque (but URL-safe) strings, and
<strong>must not</strong> be user-parseable. This is because if users are able to
deconstruct these, <em>they will do so</em>. This effectively makes the implementation
details of your API's pagination become part of the API surface, and it becomes
impossible to update those details without breaking users.</p>
<p><strong>Warning:</strong> Base-64 encoding an otherwise-transparent page token is <strong>not</strong> a
sufficient obfuscation mechanism.</p>
<p>For page tokens which do not need to be stored in a database, and which do not
contain sensitive data, an API <strong>may</strong> obfuscate the page token by defining an
internal protocol buffer message with any data needed, and send the serialized
proto, base-64 encoded.</p>
<p>Page tokens <strong>must</strong> be limited to providing an indication of where to continue
the pagination process only. They <strong>must not</strong> provide any form of
authorization to the underlying resources, and authorization <strong>must</strong> be
performed on the request as with any other regardless of the presence of a page
token.</p>
<h3 id="expiring-page-tokens">Expiring page tokens</h3>
<p>Many APIs store page tokens in a database internally. In this situation, APIs
<strong>may</strong> expire page tokens a reasonable time after they have been sent, in
order not to needlessly store large amounts of data that is unlikely to be
used. It is not necessary to document this behavior.</p>
<p><strong>Note:</strong> While a reasonable time may vary between APIs, a good rule of thumb
is three days.</p>
<h2 id="backwards-compatibility">Backwards compatibility</h2>
<p>Adding pagination to an existing RPC is a backwards-incompatible change. This
may seem strange; adding fields to proto messages is generally backwards
compatible. However, this change is <em>behaviorally</em> incompatible.</p>
<p>Consider a user whose collection has 75 resources, and who has already written
and deployed code. If the API later adds pagination fields, and sets the
default to 50, then that user's code breaks; it was getting all resources, and
now is only getting the first 50 (and does not know to advance pagination).
Even if the API set a higher default limit, such as 100, the user's collection
could grow, and <em>then</em> the code would break.</p>
<p>Additionally, <a href="https://google.aip.dev/client-libraries/4233">client libraries implement automatic
pagination</a>, typically representing paginated
RPCs using different method signatures to unpaginated ones. This means that
adding pagination to a previously-unpaginated method causes a breaking change
in those libraries.</p>
<p>For this reason, it is important to always add pagination to RPCs returning
collections <em>up front</em>; they are consistently important, and they can not be
added later without causing problems for existing users.</p>
<p><strong>Warning:</strong> This also entails that, in addition to presenting the pagination
fields, they <strong>must</strong> be <em>actually implemented</em> with a non-infinite default
value. Implementing an in-memory version (which might fetch everything then
paginate) is reasonable for initially-small collections.</p>
<h2 id="rationale">Rationale</h2>
<h3 id="degraded-skip-response">Degraded <code>skip</code> response</h3>
<p>Large collections, complex queries, and globally distributed data can all
contribute to a paginated method being unable to quickly or confidently fulfill
a given <code>skip</code> request. Backend queries can timeout, data collation can take
time, and the end user experience need not suffer as a result. In such cases,
the pagination interface can be leveraged to keep the client engaged by
providing a <code>next_page_token</code>, while the service collects an appropriate result.
When the service has definitively determined that the requested <code>skip</code> exceeds
the available results, the pagination interface is again applied and
<code>next_page_token</code> is omitted to signal the end of results.</p>
<h2 id="changelog">Changelog</h2>
<ul>
<li><strong>2025-07-08</strong>: Clarify degraded skip response guidance</li>
<li><strong>2020-05-24</strong>: Clarified that adding pagination breaks client
  libraries.</li>
<li><strong>2020-05-13</strong>: Added guidance for skipping results.</li>
<li><strong>2020-08-24</strong>: Clarified that responses are not streaming responses.</li>
<li><strong>2020-06-24</strong>: Clarified that page size is always optional for users.</li>
<li><strong>2019-02-12</strong>: Added guidance on the field being paginated over.</li>
<li><strong>2019-08-01</strong>: Changed the examples from "shelves" to "publishers", to
  present a better example of resource ownership.</li>
<li><strong>2019-07-19</strong>: Update the opacity requirement from "should" to "must".</li>
</ul>
  <footer>
  Except as otherwise noted, the content of this page is licensed under the
  <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
  Attribution 4.0 License</a>, and code samples are licensed under the
  <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
  <span class="no-print">For details, see <a href="/licensing">content
  licensing</a>.</span>
</footer>
</section>

        </section>
      </main>
      
    </div>
    <script src="//www.gstatic.com/external_hosted/hammerjs/v2_0_2/hammer.min.js"></script>
    <script src="//www.gstatic.com/glue/v22_1/glue-vanilla.min.js"></script>
    <script type="text/javascript">
      const headerElement = document.querySelector('.glue-header');
      if (headerElement) {
        new window.glue.ui.header.Header(headerElement);
      }
    </script>
  </body>
</html>