<!DOCTYPE html>
<html lang="en-US" class="glue-flexbox">
  <head>
    <title>AIP-4236: Version-aware clients</title>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Google+Sans:400,500|Product+Sans:400&amp;lang=en" rel="stylesheet"></link>
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <link rel="stylesheet" type="text/css" media="screen" href="//www.gstatic.com/glue/v22_1/glue.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=1c035e00">
    <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css?v=1c035e00">
    <script type="text/javascript" src="//code.jquery.com/jquery-3.4.0.min.js"></script>
    <script type="text/javascript" src="//www.gstatic.com/glue/latest/glue-detect.min.js"></script>
    <script type="text/javascript">
      $('html').css('visibility', 'hidden');
      $.when($.ready).then(() => {
        $('html').css('visibility', 'visible');
      });
    </script>
    <script type="text/javascript" src="/assets/js/global.js?v=1c035e00"></script>
    
<script type="text/javascript" src="/assets/js/syntax.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140054909-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-140054909-1');
    </script>
  </head>
  <body>
    <!-- prettier-ignore -->
<header class="glue-header glue-header--single">
  <div class="glue-header__bar glue-header__bar--desktop glue-header__drawer">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- LINK BAR-->
      <div class="glue-header__container glue-header__container--flex-auto">
        <nav class="glue-header__link-bar">
          <ul id="list-1" class="glue-header__list">
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/general" aria-level="1">Browse AIPs</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/news" aria-level="1">News</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/faq" aria-level="1">FAQ</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/contributing" aria-level="1">Contributing</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="https://linter.aip.dev/" target="_blank" aria-level="1">
                    API Linter
                    <svg role="img" class="glue-icon glue-icon--18px">
                      <use xlink:href="/assets/images/glue-icons.svg#open-in-new"></use>
                    </svg>
                  </a>
                </li>
              
            
          </ul>
        </nav>
      </div>
      <!-- CTA-->
      <div class="glue-header__container glue-header__container--cta">
        <div class="glue-header__cta">
        <div class="glue-sitesearch">
          <form method="GET" action="/search">
          <label for="q">Search this site</label>
          <input class="glue-sitesearch__input" type="text" name="q" id="q"
            placeholder="Search AIPs">
          <button type="submit" class="glue-button glue-sitesearch__submit" title="Submit">
            <svg role="img" class="glue-icon glue-icon--24px">
            <use xlink:href="/assets/images/glue-icons.svg#search"></use>
            </svg>
          </button>
          </form>
        </div>
        <a href="https://github.com/aip-dev/google.aip.dev" target="_blank" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile header placeholder -->
  <div class="glue-header__bar glue-header__bar--mobile">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__hamburger glue-header__hamburger--first-tier">
            <div class="glue-header__hamburger-wrapper">
              <button type="button" class="glue-header__drawer-toggle-btn"
                aria-controls="drawer" aria-expanded="false" aria-label="Open the navigation drawer">
                <svg role="img" class="glue-icon glue-icon--24px"><use xlink:href="/assets/images/glue-icons.svg#menu"></use></svg>
              </button>
            </div>
          </div>
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                  <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <!-- SKIP -->
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- CTA -->
      <div class="glue-header__container">
        <div class="glue-header__cta">
        <a href="https://github.com/aip-dev/google.aip.dev" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <div class="glue-header__drawer-backdrop"></div>
</header>
    <div class="glue-page">
      
      <main role="main" id="page-content">
        
<nav id="aip-nav" class="docs-component-nav">
  <ul class="nav-list">
    <li class="nav-item nav-item-header">AIPs by Scope</li>
    <li class="nav-item">
      <a href="/general">General</a>
    </li>
    <li class="nav-item">
      <a href="/cloud">Google Cloud Platform</a>
    </li>
    <li class="nav-item">
      <a href="/auth">Auth</a>
    </li>
    <li class="nav-item">
      <a href="/client-libraries">Client libraries</a>
    </li>
    <li class="nav-item">
      <a href="/apps">Workspace</a>
    </li>
    <li class="nav-item">
      <a href="/aog">Actions on Google</a>
    </li>
    <li class="nav-item nav-item-header">AIPs</li>
    <li class="nav-item">
      <a href="/4210">
        <span class="aip-number">4210</span>
        Client library generators
      </a>
    </li>
    <li class="nav-item">
      <a href="/4221">
        <span class="aip-number">4221</span>
        Client-side retry
      </a>
    </li>
    <li class="nav-item">
      <a href="/4222">
        <span class="aip-number">4222</span>
        Routing headers
      </a>
    </li>
    <li class="nav-item">
      <a href="/4223">
        <span class="aip-number">4223</span>
        Client-side payload validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/4231">
        <span class="aip-number">4231</span>
        Parsing resource names
      </a>
    </li>
    <li class="nav-item">
      <a href="/4232">
        <span class="aip-number">4232</span>
        Method signatures
      </a>
    </li>
    <li class="nav-item">
      <a href="/4233">
        <span class="aip-number">4233</span>
        Automatic pagination
      </a>
    </li>
    <li class="nav-item">
      <a href="/4234">
        <span class="aip-number">4234</span>
        Common service client mixins
      </a>
    </li>
    <li class="nav-item">
      <a href="/4235">
        <span class="aip-number">4235</span>
        Automatically populate fields in the request message
      </a>
    </li>
    <li class="nav-item nav-item-active">
      <a href="/4236">
        <span class="aip-number">4236</span>
        Version-aware clients
      </a>
    </li>
    <li class="nav-item">
      <a href="/4290">
        <span class="aip-number">4290</span>
        Docker interface
      </a>
    </li>
    </ul>
</nav>
<section id="jump-content">
          
<aside id="aip-sidebar" class="docs-component-sidebar">
  <table id="aip-summary">
    <tr><th colspan="2">Version-aware clients</th></tr>
    <tr><td>Number</td><td>4236</td></tr>
    <tr><td>Permalink</td><td><a href="https://google.aip.dev/client-libraries/4236">google.aip.dev/client-libraries/4236</a></td></tr>
    <tr><td>Scope</td><td>Client libraries</td></tr>
    <tr><td>State</td><td>Approved</td></tr>
    <tr><td>Created</td><td>2024-05-16</td></tr>
    <tr><td>Updated</td><td>2024-05-16</td></tr>
  </table>

  <section id="aip-toc" class="docs-component-sidebar-toc">
    <div class="toc"><span class="toctitle">Contents</span><ul>
<li><a href="#generator-and-client-library-behavior">Generator and client library behavior</a><ul>
<li><a href="#generated-client-documentation">Generated client documentation</a></li>
<li><a href="#version-opacity">Version opacity</a></li>
</ul>
</li>
<li><a href="#rationale">Rationale</a><ul>
<li><a href="#necessity-for-versioning">Necessity for Versioning</a></li>
<li><a href="#importance-of-opaque-treatment">Importance of Opaque Treatment</a></li>
<li><a href="#mutual-exclusivity-of-query-and-header">Mutual Exclusivity of Query and Header</a></li>
<li><a href="#inclusion-in-documentation">Inclusion in documentation</a></li>
</ul>
</li>
<li><a href="#changelog">Changelog</a></li>
</ul>
</div>

  </section>

  <section class="docs-component-sidebar-actions">
    <ul>
      <li><a href="https://github.com/aip-dev/google.aip.dev/issues/">File Bug</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/blob/master/aip/client-libraries/4236.md">View source</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/edit/master/aip/client-libraries/4236.md">Edit this page</a></li>
    </ul>
  </section>
</aside>
<section id="aip-main" class="docs-component-main">
  <section class="section-breadcrumbs">
  <nav
    class="glue-breadcrumbs glue-mod-mt-std glue-mod-mb-std"
    aria-label="You are here."
  >
    <ol class="glue-breadcrumbs__list aip-breadcrumbs">
      <li class="glue-breadcrumbs__item" aria-level="1">
        <a class="glue-breadcrumbs__link" href="/">
          API Improvement Proposals
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item" aria-level="2">
        <a class="glue-breadcrumbs__link" href="/client-libraries">
          Client libraries AIPs
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item glue-breadcrumbs__item--active"
          aria-level="3">
        Version-aware clients
      </li>
    </ol>
  </nav>
</section>
  
  <h4 class="aip-number">AIP-4236</h4>
  <h1 id="version-aware-clients">Version-aware clients</h1>
<p>APIs can annotate <a href="https://google.aip.dev/9#api-interface">API interfaces</a> with
<a href="https://github.com/googleapis/googleapis/blob/master/google/api/client.proto"><code>google.api.api_version</code></a>. If <code>google.api.api_version</code> is
specified, version-aware clients <strong>must</strong> include the value of
<code>google.api.api_version</code> in the request to the API and in the documentation of
the per-API interface clients.</p>
<h2 id="generator-and-client-library-behavior">Generator and client library behavior</h2>
<p>If an API interface is annotated with <code>google.api.api_version</code>, client
library generators <strong>must</strong> include either an HTTP query parameter <code>$apiVersion</code>
or HTTP header/gRPC metadata key <code>X-Goog-Api-Version</code>, but a request
<strong>must not</strong> contain both.</p>
<h3 id="generated-client-documentation">Generated client documentation</h3>
<p>Generated client documentation for a given API interface <strong>must</strong> include the
value of <code>google.api.api_version</code>, if it exists in the source protos. The
comment <strong>must</strong> include the original API interface name and the exact contents
of the annotation.</p>
<p><strong>Note:</strong> The text does not need to match exactly to the examples below, but it
still needs to fulfill the requirements desribed herein.</p>
<p>For example, the following API interface definition would produce the following
Go client documentation:</p>
<div class="highlight language-proto"><pre><span></span><code><span class="kd">service</span> <span class="n">LibraryService</span> <span class="p">{</span>
    <span class="k">option</span> <span class="p">(</span><span class="n">google.api.api_version</span><span class="p">)</span> <span class="o">=</span> <span class="s">&quot;2026-01-01&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight language-go"><pre><span></span><code><span class="c1">// The LibraryClient is a client for interacting with the Cloud Library...</span>
<span class="c1">//</span>
<span class="c1">// This client uses LibraryService version 2026-01-01.</span>
<span class="kd">type</span> <span class="nx">LibraryClient</span> <span class="kd">struct</span> <span class="p">{}</span>
</code></pre></div>
<p>Any generated documentation for an entire <a href="https://google.aip.dev/9#api-service">API service's</a> client
package <strong>must</strong> include a section that lists the client-interface-version
tuples present in the package. For example, the following API interface
defintions would produce the following client package documentation section:</p>
<div class="highlight language-proto"><pre><span></span><code><span class="kd">service</span> <span class="n">LibraryService</span> <span class="p">{</span>
    <span class="k">option</span> <span class="p">(</span><span class="n">google.api.api_version</span><span class="p">)</span> <span class="o">=</span> <span class="s">&quot;2026-01-01&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">service</span> <span class="n">BookService</span> <span class="p">{</span>
    <span class="k">option</span> <span class="p">(</span><span class="n">google.api.api_version</span><span class="p">)</span> <span class="o">=</span> <span class="s">&quot;2026-05-15&quot;</span><span class="p">;</span>
<span class="p">}</span>
<span class="kd">service</span> <span class="n">ShelfService</span> <span class="p">{</span>
    <span class="k">option</span> <span class="p">(</span><span class="n">google.api.api_version</span><span class="p">)</span> <span class="o">=</span> <span class="s">&quot;2026-02-05&quot;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight language-md"><pre><span></span><code><span class="gu">## API Versions</span>

<span class="k">*</span> LibraryClient uses LibraryService version 2026-01-01
<span class="k">*</span> BookClient uses BookService version 2026-05-15
<span class="k">*</span> ShelfClient uses ShelfService version 2026-02-05
</code></pre></div>
<p>If all API interfaces share the same API version, this list <strong>should</strong> be
reduced to a single sentence for brevity. For example, if all versions were the
same in the definitions above, the generated client package documentation would
be as follows:</p>
<div class="highlight language-md"><pre><span></span><code><span class="gu">## API Versions</span>

All clients use API version 2026-01-01.
</code></pre></div>
<h3 id="version-opacity">Version opacity</h3>
<p>Clients and generators <strong>must</strong> treat the value of <code>google.api.api_version</code> as
opaque to ensure robust compatibility. This means that the specific format or
structure of the version string <strong>must not</strong> be parsed or interpreted for any
purpose beyond identifying the intended API version.</p>
<h2 id="rationale">Rationale</h2>
<h3 id="necessity-for-versioning">Necessity for Versioning</h3>
<p>Explicit API versioning using the <code>google.api.api_version</code> annotation is
essential for maintaining compatibility between clients and services over time.
As services evolve, their schemas and behaviors may change. By specifying the
API version, a client communicates its expectations to the API service. This
allows the API service to respond in a manner consistent with the client's
intended semantics, preventing errors or unexpected results due to incompatible
changes.</p>
<h3 id="importance-of-opaque-treatment">Importance of Opaque Treatment</h3>
<p>Treating the <code>google.api.api_version</code> value as opaque is important for ensuring
robust compatibility guarantees. By using this identifier opaquely, clients
avoid making assumptions about the underlying versioning scheme, which may
change independently of the API itself. This flexibility allows API service
providers to evolve their versioning strategies without impacting client
compatibility.</p>
<h3 id="mutual-exclusivity-of-query-and-header">Mutual Exclusivity of Query and Header</h3>
<p>Both the query parameter and header mechanisms exist to provide flexibility for
different client environments. However, allowing both simultaneously could lead
to ambiguity if the values differ. To ensure consistent version identification
and prevent potential conflicts, only one mechanism should be used at a time.</p>
<h3 id="inclusion-in-documentation">Inclusion in documentation</h3>
<p>The API version identifies the iteration of the API contract being consumed by
the client and thus the end user. The end user needs a means of relating the
API version in use by the client to other API artifacts (such as product
documentation and other client surfaces) and vice versa.</p>
<h2 id="changelog">Changelog</h2>
<ul>
<li><strong>2025-12-08</strong>: Add documentation generation requirements and reformat.</li>
</ul>
  <footer>
  Except as otherwise noted, the content of this page is licensed under the
  <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
  Attribution 4.0 License</a>, and code samples are licensed under the
  <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
  <span class="no-print">For details, see <a href="/licensing">content
  licensing</a>.</span>
</footer>
</section>

        </section>
      </main>
      
    </div>
    <script src="//www.gstatic.com/external_hosted/hammerjs/v2_0_2/hammer.min.js"></script>
    <script src="//www.gstatic.com/glue/v22_1/glue-vanilla.min.js"></script>
    <script type="text/javascript">
      const headerElement = document.querySelector('.glue-header');
      if (headerElement) {
        new window.glue.ui.header.Header(headerElement);
      }
    </script>
  </body>
</html>