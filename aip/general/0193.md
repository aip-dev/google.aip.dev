---
id: 193
state: approved
created: 2019-07-26
placement:
  category: polish
  order: 30
---

# Errors

Effective error communication is an important part of designing simple and
intuitive APIs. Services returning standardized error responses enable API
clients to construct centralized common error handling logic. This common logic
simplifies API client applications and eliminates the need for cumbersome
custom error handling code.

## Guidance

Services that encounter an error **must** return a
[`google.rpc.Status`][Status] message.

### Example Response

```proto
code: 429
message: "The zone 'projects/<project-id>/zones/us-west1-b'..."
details: [
  [google.rpc.ErrorInfo]: {
    reason: "STOCKOUT",
    domain: "compute.googleapis.com",
    metadata: {
      maxInstances: 200
      usedInstances: 190
      requestedInstances: 30
    }
  },
  [google.rpc.LocalizedMessage]: {
    locale: "en-US",
    message: "The zone 'projects/<project-id>/zones/us-west1-b'..."
  }
]
```

### Fields

#### `code`

The `code` field in the error response message **must** use the
canonical error codes defined in [`google.rpc.Code`][Code].
[gRPC status code documentation][] provides details about the types and
usage of the canonical error codes.

#### `message`

The `google.rpc.Status` response **must** include the `message` field.
The `message` field's text:

* **should** help a reasonably technical user _understand_ and _resolve_
the underlying issue.
* **must not** assume that the user will know anything about the erroring
system's underlying implementation.
* **should not** assume that the user is an expert in your particular API.
* **should** be brief and actionable.

In an event where returned error would require an extensive explanation or
technical support help, the error message **should** provide a links to such
resources.

#### `details`

The repeated `details` field

* **must** include a single `ErrorInfo` message
* **should** include a `LocalizedMessage` message
* **may** include other messages defined in [standard payloads][details].

### Extensions

#### `ErrorInfo`

API clients often write automation code that interpret services' AIP responses.
When machine readable information is unavailable, clients parse and interpret
response string included in the `message` field. Updates to a client parsed
`message` field **must** be considered a backwards-incompatible change.

To discourage clients' string parsing practice services **must** include
the `ErrorInfo` extension in the returned `Status` message.

Changes to the structure of the `ErrorInfo` field **must** be considered
backwards-incompatible.

#### `LocalizedMessage`

Error messages **must** be in English. If a service provides localizations
the service **should** use [`google.rpc.LocalizedMessage`][details] extension
and include it in the `details` field.

##### Legacy system usage
For legacy systems where the top level `message` field in the `Status` message
has been parsed by clients the `LocalizatizedMessage` extension **should** be
included in the error response. The inclusion of `LocalizatizedMessage` extension
**must** be accompanied by inclusion of the `ErrorInfo` extension.

### Partial errors

APIs **should not** support partial errors. Partial errors add significant
complexity for users, because they usually sidestep the use of error codes, or
move those error codes into the response message, where the user must write
specialized error handling logic to address the problem.

However, occasionally partial errors are necessary, particularly in bulk
operations where it would be hostile to users to fail an entire large request
because of a problem with a single entry.

Methods that require partial errors **should** use [long-running operations][],
and the method **should** put partial failure information in the metadata
message. The errors themselves **must** still be represented with a
[`google.rpc.Status`][Status] object.

## Further reading

- For which error codes to retry, see [AIP-194](https://aip.dev/194).
- For how to retry errors in client libraries, see [AIP-4221](https://aip.dev/client-libraries/4221).

## Changelog

- **2022-08-23**: Added ErrorInfo requirement and guidance for LocalizedMessage.
- **2022-08-12**: Reworded/Simplified intro to add clarity to the intent.
- **2020-01-22**: Added a reference to the [`ErrorInfo`][ErrorInfo] message.
- **2019-10-14**: Added guidance restricting error message mutability to if
  there is a machine-readable identifier present.
- **2019-09-23**: Added guidance about error message strings being able to
  change.

<!-- prettier-ignore-start -->
[aip-4221]: ../client-libraries/4221.md
[details]: https://github.com/googleapis/googleapis/blob/master/google/rpc/error_details.proto
[ErrorInfo]: https://github.com/googleapis/googleapis/blob/master/google/rpc/error_details.proto#L111
[grpc status code documentation]: https://github.com/grpc/grpc/blob/master/doc/statuscodes.md
[Code]: https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto
[Status]: https://github.com/googleapis/googleapis/blob/master/google/rpc/status.proto
[long-running operations]: ./0151.md
<!-- prettier-ignore-end -->
