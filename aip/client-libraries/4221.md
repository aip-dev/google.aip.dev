---
aip:
  id: 4221
  scope: client-libraries
  state: draft
  created: 2019-06-17
permalink: /client-libraries/4221
redirect_from:
  - /4221
---

# Client-side retry

Many APIs have error modes that a client should retry. These error modes vary
across APIs, leaving users to hand-write retry logic around client libraries
based on available documentation.

## Guidance

Client libraries **may** provide automatic client-side retry logic. Client
libraries with automatic client-side retry logic **should** provide mechanisms
(e.g. client initialization options) for users to configure it.

Client libraries for API systems that support remotely-resolved client retry 
configuration **should** respect the remotely-resolved configuration. However,
user configuration via the aforementioned mechanisms **must** be respected.

Client library generators implementing this feature **must** accept a retry
configuration. This retry configuration **may** be supplied via a `protoc`
plugin option. In the absence of a given retry configuration, client library
generators **should not** generate a default retry configuration.

### Client library client-side retry implementation

Client libraries **should** make client-side retry transparent to the user. The
user **should not** have to opt-in to client-side retry explicitly, but the user
**must** have a way to disable client-side retry altogether.

### Client library retry configuration mechanisms

Client libraries **should** surface a mechanism through which users may control
the client-side retry configuration, including being able to disable client-side
retry altogether.

For example, client libraries for Go gRPC services can supply an
option, [WithDisableRetry][0], at client initialization to disable the use of 
the automatic client-side retry logic.

### Remotely-resolved client configuration

Some API systems have built-in mechanisms for clients to retrieve a
remotely-defined configuration that includes client-side retry configuration.

For example, gRPC supports the [resolution of client configuration][1] that
includes configuration for [client-side retry][2].

Client libraries **should** respect the remotely-resolved configuration, except
when a user overrides it via the aforementioned [client lirbary retry
configuration mechanisms](#client-library-retry-configuration-mechanisms).

### Client library generator retry configuration

Client library generators that implement client-side retry **must** accept a
retry configuration. This is to enable API producers to supply a retry
configuration that best-suits their service.

This retry configuration **may** be a `protoc` plugin option. For example,
a generator could accept the file path of the configuration with an option like:

`--{plugin_name}_opt="retry-config=/path/to/config.file"`

In the absence of a retry configuration, a generator **should not** generate a
"default" retry configuration. This would result in a generated client library
that did not retry anything, unless configured by the user.

<!-- prettier-ignore-start -->
[0]: https://godoc.org/google.golang.org/grpc#WithDisableRetry
[1]: https://github.com/grpc/grpc/blob/837a99e1d49a892e6f2c46ee09a1b6b8405571c6/doc/naming.md#resolver-plugins
[2]: https://github.com/grpc/proposal/blob/d4fc009e55f95297374e821d67d679b931753a59/A6-client-retries.md
<!-- prettier-ignore-end -->
