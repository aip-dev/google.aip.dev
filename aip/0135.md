---
aip:
  id: 135
  state: approved
  created: 2019-01-24
  updated: 2019-06-10
permalink: /135
redirect_from:
  - /0135
---

# Standard operations: Delete

In REST APIs, it is customary to make a `DELETE` request to a resource's URI
(for example, `/v1/publishers/{publisher}/books/{book}`) in order to delete
that resource.

## Guidance

A service **should** generally support the Delete operation for resources unless it is
not valuable for users to do so.

#### OpenAPI

Delete operations are specified using the following pattern:

```yaml
paths:
  /books/{id}:
    parameters:
      - name: id
        in: path
        description: The id of the book to be deleted
        required: true
    delete:
      operationId: deleteBook
      description: Delete a book.
      responses:
        204:
          description: The book has been successfully deleted.
        404:
          description: The requested book was not found.
```

- The `path` **must** be the URI of the resource to be deleted.
  - The `path` **should** contain a path variable corresponding to the resource id.
  - The resource id path variable **should** be called `id`.
  - The resource id path variable **should** be the final path segment.
  - The resource id path variable **should** be defined in the parameters of the path object
  - The resource id path variable **must** be required.
- The HTTP method **must** be `DELETE`.
- There **must not** be a request body.
- The operationId **must** begin with the word "delete". The remainder of the
  operationId **should** be the singular form of the resource name.
- At least one success response (status code `2xx`) **must** be defined
- The `404 Not Found` response **must** be defined

##### Service behavior

- The Delete operation **must** be idempotent.
- If a Delete request contains a body, the body **must** be ignored, and
  **must not** cause an error.
- The Delete response **should** conform to the following:
  - If the resource is deleted synchronously, the Delete response **should** be
    status code `204 No Content` with an empty response body.
  - If the resource is [soft deleted](#soft-delete), the Delete response **should** be
    status code `200 OK` with a response body containing the updated resource.
  - If the Delete operation is [long-running](#long-running-delete), the Delete response **should**
    be status code `202 Accepted` and the response body **must** be
    a status monitor which resolves to the correct response.

#### Protocol buffers

Delete methods are specified using the following pattern:

```proto
rpc DeleteBook(DeleteBookRequest) returns (google.protobuf.Empty) {
  option (google.api.http) = {
    delete: "/v1/{name=publishers/*/books/*}"
  };
  option (google.api.method_signature) = "name";
}
```

- The RPC's name **must** begin with the word `Delete`. The remainder of the
  RPC name **should** be the singular form of the resource's message name.
- The request message **must** match the RPC name, with a `-Request` suffix.
- The response message **should** be `google.protobuf.Empty`.
  - If the resource is [soft deleted](#soft-delete), the response message
    **should** be the resource itself.
  - If the delete RPC is [long-running](#long-running-delete), the response
    message **must** be a `google.longrunning.Operation` which resolves to the
    correct response.
- The HTTP verb **must** be `DELETE`.
- The request message field receiving the resource name **should** map to the
  URL path.
  - This field **should** be called `name`.
  - The `name` field **should** be the only variable in the URI path. All
    remaining parameters **should** map to URI query parameters.
- There **must not** be a `body` key in the `google.api.http` annotation.
- There **should** be exactly one `google.api.method_signature` annotation,
  with a value of `"name"`. If an etag or force field are used, they **may** be
  included in the signature.

The Delete method **should** succeed if and only if a resource was present and
was successfully deleted. If the resource did not exist, the method **should**
send a `NOT_FOUND` error.

##### Request message

Delete methods implement a common request message pattern:

```proto
message DeleteBookRequest {
  // The name of the book to delete.
  // Format: publishers/{publisher}/books/{book}
  string name = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      type: "library-example.googleapis.com/Book"
    }];
}
```

- A `name` field **must** be included. It **should** be called `name`.
  - The field **should** be annotated as required.
  - The field **should** identify the [resource type][aip-123] that it
    references.
- The comment for the field **should** document the resource pattern.
- The request message **must not** contain any other required fields, and
  **should not** contain other optional fields except those described in this
  or another AIP.

### Soft delete

A service **may** support the ability to "undelete" resources, to allow for situations
where users mistakenly delete resources and need the ability to recover.

If a resource needs to support undelete, the Delete operation **should** simply
mark the resource as having been deleted, but not completely remove it from the
system. If the operation behaves this way, it **should** return status code `200 OK`,
not `204 No Content`, and the updated resource with its [state][aip-216] set to
`DELETED`.

Soft-deleted resources **should not** show up in [list][aip-132] requests by
default (unless `bool show_deleted` is true).

The undelete functionality **should** be implemented through an "undelete"
[custom method][aip-136].

A service that supports soft delete of resources **may** choose a reasonable strategy for
purging those resources, including automatic purging after a reasonable time
(such as 30 days), allowing users to [set an expiry time][aip-214], or
retaining the resources indefinitely. Regardless of what strategy is selected,
the service **should** document when soft deleted resources will be completely
removed.

### Long-running delete

Some resources take longer to delete than is reasonable for a
regular HTTP request. In this situation, the service **should** use a long-running
operation instead.

#### OpenAPI

- The service**should** respond with status code `202 Accepted` and the response
    body **must** be a status monitor (as described in [aip-151][]) which resolves to the correct response.

#### Protocol buffers


```proto
rpc DeleteBook(DeleteBookRequest) returns (google.longrunning.Operation) {
  option (google.api.http) = {
    delete: "/v1/{name=publishers/*/books/*}"
  };
  option (google.longrunning.operation_info) = {
    response_type: "google.protobuf.Empty"
    metadata_type: "OperationMetadata"
  }
}
```

- The response type **must** be set to the appropriate return type if the RPC
  was not long-running: `google.protobuf.Empty` for most Delete RPCs, or the
  resource itself for [soft delete](#soft-delete).
- Both the `response_type` and `metadata_type` fields **must** be specified
  (even if they are `google.protobuf.Empty`).

### Cascading delete

Sometimes, it may be necessary for users to be able to delete a resource as
well as all applicable child resources. However, since deletion is usually
permanent, it is also important that users not do so accidentally, as
reconstructing wiped-out child resources may be quite difficult.

If a service allows deletion of a resource that may have child resources,
the Delete operation **should** provide a `bool force` query parameter on
the request, which the user sets to explicitly opt in to a cascading delete.

#### OpenAPI

```yaml
paths:
  /books/{id}:
    parameters:
      - name: id
        in: path
        description: The id of the book to be deleted
        required: true
    delete:
      operationId: deleteBook
      description: Delete a book.
      parameters:
        - name: force
          type: boolean
          in: query
          description: force deletion of all child resources
          default: false
      responses:
        204:
          description: The book and all its children have been successfully deleted.
        412:
          description: Delete failed - child resources exist and `force` not specified
```

The Delete operation **must** fail with a `412 Precondition Failed` error if the `force` parameter
is `false` (or unset) and child resources are present.

#### Protocol buffers


```proto
message DeletePublisherRequest {
  // The name of the publisher to delete.
  // Format: publishers/{publisher}
  string name = 1;

  // If set to true, any books from this publisher will also be deleted.
  // (Otherwise, the request will only work if the publisher has no books.)
  bool force = 2;
}
```

The Delete operation **must** fail with a `FAILED_PRECONDITION` error if the `force` field
is `false` (or unset) and child resources are present.

### Protected delete

Sometimes, it may be necessary for users to ensure that no changes have been
made to a resource that is being deleted.

#### OpenAPI

If the service supports protected delete it **must** accept an `if-match` header
whose value is obtained from the `etag` header in the response of a previous request
on the resource.

```yaml
paths:
  /books/{id}:
    parameters:
      - name: id
        in: path
        description: The id of the book to be deleted
        required: true
    delete:
      operationId: deleteBook
      description: Delete a book.
      parameters:
        - name: if-match
          type: string
          in: header
          description: force deletion of all child resources
      responses:
        204:
          description: The book and all its children have been successfully deleted.
        412:
          description: Precondition not met
```

A Delete request **must** fail with a `412 Precondition Failed` error if the request
provides an `if-match` header and the header value does not match the server-computed `etag`.

#### Protocol buffers

If a resource provides an [etag][],
the delete request **may** accept the etag (as either required or optional):

```proto
message DeleteBookRequest {
  // The name of the book to delete.
  // Format: publishers/{publisher}/books/{book}
  string name = 1;

  // Optional. The etag of the book.
  // If this is provided, it must match the server's etag.
  string etag = 2;
}
```

If the etag is provided and does not match the server-computed etag, the
request **must** fail with a `FAILED_PRECONDITION` error code.

### Errors

A Delete response for a non-existent resource **must not** be a success (`2xx`) status code.

If the user does not have permission to access the resource, regardless of
whether or not it exists, the service **must** respond with error `403 Forbidden`
Permission **must** be checked prior to checking if the resource exists.

If the user does have proper permission, but the requested resource does not exist,
- the service **should** respond with `404 Not Found`
- the service **may** respond with `410 Gone` if the resource is known to have previously existed.

[aip-121]: ./0121.md
[aip-123]: ./0123.md
[aip-132]: ./0132.md
[aip-136]: ./0136.md
[aip-151]: ./0151.md
[aip-214]: ./0214.md
[aip-216]: ./0216.md
[etag]: ./0134.md#etags

## Changelog

- **2020-02-03**: Added guidance for error cases.
- **2019-10-18**: Added guidance on annotations.
- **2019-08-01**: Changed the examples from "shelves" to "publishers", to
  present a better example of resource ownership.
- **2019-06-10**: Added guidance for long-running delete.
- **2019-05-29**: Added an explicit prohibition on arbitrary fields in standard
  methods.
