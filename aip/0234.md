---
aip:
  id: 234
  state: draft
  created: 2019-06-18
permalink: /234
redirect_from:
  - /0234
---

# Batch Update

Some APIs need to allow users to modify a set of resources in a single
transaction. A batch update method provides this functionality.

## Guidance

Batch update methods are specified using the following pattern:

```proto
rpc BatchUpdateBooks(BatchUpdateBooksRequest) returns (BatchUpdateBooksResponse) {
  option (google.api.http) = {
    post: "/v1/shelves/-/books:batchUpdate"
    body: "*"
  };
}
```

- The RPC's name must begin with `BatchUpdate`. The remainder of the RPC name
  should be the plural form of the resource being updated.
- The request and response messages **must** match the RPC name, with `-Request`
  and `-Response` suffixes.
  - However, in the event that the request may take a significant amount of
    time, the response message **must** be a `google.longrunning.Operation`
    which ultimately resolves to the `-Response` type.
- The HTTP verb must be `POST`.
- The HTTP URI must end with `:batchUpdate`.
- The URL path **should** represent the collection for the resource, matching
  the collection used for simple CRUD operations. If the operation spans
  parents, a dash (`-`) **may** be used as a wildcard.
- The body clause in the `google.api.http` annotation should be `"*"`.
- The operation should be atomic: it should fail for all resources or succeed
  for all resources (no partial success).

### Request message

The request for a batch update method should be specified with the following
pattern:

```proto
message BatchUpdateBookRequest {
  // The request message specifying the resources to update.
  // A maximum of 1000 books can be modified in a batch.
  repeated UpdateBookRequest requests = 1;
}
```

- The request message **must** include one repeated field which accepts the
  request messages specifying the resources to update, as specified for
  [standard Update methods][request-message]. The field **should** be named
  `requests`.
- The request message **must not** contain any other required fields, and
  **should not** contain other optional fields except those described in this or
  another AIP.
- The comment above the names field **should** document the maximum number of
  requests allowed.

### Response message

The response for a batch update method **should** be specified with the
following pattern:

```proto
message BatchUpdateBooksResponse {
  // Books updated.
  repeated Book books = 1;
}
```

- The response message **must** include one repeated field corresponding to the
  resources that were updated.

[request-message]: ./0134.md#request-message
