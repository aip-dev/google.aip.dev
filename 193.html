<!DOCTYPE html>
<html lang="en-US" class="glue-flexbox">
  <head>
    <title>AIP-193: Errors</title>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Google+Sans:400,500|Product+Sans:400&amp;lang=en" rel="stylesheet"></link>
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <link rel="stylesheet" type="text/css" media="screen" href="//www.gstatic.com/glue/v22_1/glue.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=f1d56fe5">
    <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css?v=f1d56fe5">
    <script type="text/javascript" src="//code.jquery.com/jquery-3.4.0.min.js"></script>
    <script type="text/javascript" src="//www.gstatic.com/glue/latest/glue-detect.min.js"></script>
    <script type="text/javascript">
      $('html').css('visibility', 'hidden');
      $.when($.ready).then(() => {
        $('html').css('visibility', 'visible');
      });
    </script>
    <script type="text/javascript" src="/assets/js/global.js?v=f1d56fe5"></script>
    
<script type="text/javascript" src="/assets/js/syntax.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140054909-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-140054909-1');
    </script>
  </head>
  <body>
    <!-- prettier-ignore -->
<header class="glue-header glue-header--single">
  <div class="glue-header__bar glue-header__bar--desktop glue-header__drawer">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- LINK BAR-->
      <div class="glue-header__container glue-header__container--flex-auto">
        <nav class="glue-header__link-bar">
          <ul id="list-1" class="glue-header__list">
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/general" aria-level="1">Browse AIPs</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/news" aria-level="1">News</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/faq" aria-level="1">FAQ</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/contributing" aria-level="1">Contributing</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="https://linter.aip.dev/" target="_blank" aria-level="1">
                    API Linter
                    <svg role="img" class="glue-icon glue-icon--18px">
                      <use xlink:href="/assets/images/glue-icons.svg#open-in-new"></use>
                    </svg>
                  </a>
                </li>
              
            
          </ul>
        </nav>
      </div>
      <!-- CTA-->
      <div class="glue-header__container glue-header__container--cta">
        <div class="glue-header__cta">
        <div class="glue-sitesearch">
          <form method="GET" action="/search">
          <label for="q">Search this site</label>
          <input class="glue-sitesearch__input" type="text" name="q" id="q"
            placeholder="Search AIPs">
          <button type="submit" class="glue-button glue-sitesearch__submit" title="Submit">
            <svg role="img" class="glue-icon glue-icon--24px">
            <use xlink:href="/assets/images/glue-icons.svg#search"></use>
            </svg>
          </button>
          </form>
        </div>
        <a href="https://github.com/aip-dev/google.aip.dev" target="_blank" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile header placeholder -->
  <div class="glue-header__bar glue-header__bar--mobile">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__hamburger glue-header__hamburger--first-tier">
            <div class="glue-header__hamburger-wrapper">
              <button type="button" class="glue-header__drawer-toggle-btn"
                aria-controls="drawer" aria-expanded="false" aria-label="Open the navigation drawer">
                <svg role="img" class="glue-icon glue-icon--24px"><use xlink:href="/assets/images/glue-icons.svg#menu"></use></svg>
              </button>
            </div>
          </div>
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                  <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <!-- SKIP -->
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- CTA -->
      <div class="glue-header__container">
        <div class="glue-header__cta">
        <a href="https://github.com/aip-dev/google.aip.dev" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <div class="glue-header__drawer-backdrop"></div>
</header>
    <div class="glue-page">
      
      <main role="main" id="page-content">
        
<nav id="aip-nav" class="docs-component-nav">
  <ul class="nav-list">
    <li class="nav-item nav-item-header">AIPs by Scope</li>
    <li class="nav-item">
      <a href="/general">General</a>
    </li>
    <li class="nav-item">
      <a href="/cloud">Google Cloud Platform</a>
    </li>
    <li class="nav-item">
      <a href="/auth">Auth</a>
    </li>
    <li class="nav-item">
      <a href="/client-libraries">Client libraries</a>
    </li>
    <li class="nav-item">
      <a href="/apps">GSuite</a>
    </li>
    <li class="nav-item">
      <a href="/aog">Actions on Google</a>
    </li>
    <li class="nav-item nav-item-header">AIPs</li>
    <li class="nav-item">
      <a href="/1">
        <span class="aip-number">1</span>
        AIP Purpose and Guidelines
      </a>
    </li>
    <li class="nav-item">
      <a href="/2">
        <span class="aip-number">2</span>
        AIP Numbering
      </a>
    </li>
    <li class="nav-item">
      <a href="/3">
        <span class="aip-number">3</span>
        AIP Versioning
      </a>
    </li>
    <li class="nav-item">
      <a href="/8">
        <span class="aip-number">8</span>
        AIP Style and Guidance
      </a>
    </li>
    <li class="nav-item">
      <a href="/9">
        <span class="aip-number">9</span>
        Glossary
      </a>
    </li>
    <li class="nav-item">
      <a href="/100">
        <span class="aip-number">100</span>
        API Design Review FAQ
      </a>
    </li>
    <li class="nav-item">
      <a href="/111">
        <span class="aip-number">111</span>
        Planes
      </a>
    </li>
    <li class="nav-item">
      <a href="/121">
        <span class="aip-number">121</span>
        Resource-oriented design
      </a>
    </li>
    <li class="nav-item">
      <a href="/122">
        <span class="aip-number">122</span>
        Resource names
      </a>
    </li>
    <li class="nav-item">
      <a href="/123">
        <span class="aip-number">123</span>
        Resource types
      </a>
    </li>
    <li class="nav-item">
      <a href="/124">
        <span class="aip-number">124</span>
        Resource association
      </a>
    </li>
    <li class="nav-item">
      <a href="/126">
        <span class="aip-number">126</span>
        Enumerations
      </a>
    </li>
    <li class="nav-item">
      <a href="/127">
        <span class="aip-number">127</span>
        HTTP and gRPC Transcoding
      </a>
    </li>
    <li class="nav-item">
      <a href="/128">
        <span class="aip-number">128</span>
        Declarative-friendly interfaces
      </a>
    </li>
    <li class="nav-item">
      <a href="/130">
        <span class="aip-number">130</span>
        Methods
      </a>
    </li>
    <li class="nav-item">
      <a href="/131">
        <span class="aip-number">131</span>
        Standard methods: Get
      </a>
    </li>
    <li class="nav-item">
      <a href="/132">
        <span class="aip-number">132</span>
        Standard methods: List
      </a>
    </li>
    <li class="nav-item">
      <a href="/133">
        <span class="aip-number">133</span>
        Standard methods: Create
      </a>
    </li>
    <li class="nav-item">
      <a href="/134">
        <span class="aip-number">134</span>
        Standard methods: Update
      </a>
    </li>
    <li class="nav-item">
      <a href="/135">
        <span class="aip-number">135</span>
        Standard methods: Delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/136">
        <span class="aip-number">136</span>
        Custom methods
      </a>
    </li>
    <li class="nav-item">
      <a href="/140">
        <span class="aip-number">140</span>
        Field names
      </a>
    </li>
    <li class="nav-item">
      <a href="/141">
        <span class="aip-number">141</span>
        Quantities
      </a>
    </li>
    <li class="nav-item">
      <a href="/142">
        <span class="aip-number">142</span>
        Time and duration
      </a>
    </li>
    <li class="nav-item">
      <a href="/143">
        <span class="aip-number">143</span>
        Standardized codes
      </a>
    </li>
    <li class="nav-item">
      <a href="/144">
        <span class="aip-number">144</span>
        Repeated fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/145">
        <span class="aip-number">145</span>
        Ranges
      </a>
    </li>
    <li class="nav-item">
      <a href="/146">
        <span class="aip-number">146</span>
        Generic fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/147">
        <span class="aip-number">147</span>
        Sensitive fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/148">
        <span class="aip-number">148</span>
        Standard fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/149">
        <span class="aip-number">149</span>
        Unset field values
      </a>
    </li>
    <li class="nav-item">
      <a href="/151">
        <span class="aip-number">151</span>
        Long-running operations
      </a>
    </li>
    <li class="nav-item">
      <a href="/152">
        <span class="aip-number">152</span>
        Jobs
      </a>
    </li>
    <li class="nav-item">
      <a href="/153">
        <span class="aip-number">153</span>
        Import and export
      </a>
    </li>
    <li class="nav-item">
      <a href="/154">
        <span class="aip-number">154</span>
        Resource freshness validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/155">
        <span class="aip-number">155</span>
        Request identification
      </a>
    </li>
    <li class="nav-item">
      <a href="/156">
        <span class="aip-number">156</span>
        Singleton resources
      </a>
    </li>
    <li class="nav-item">
      <a href="/157">
        <span class="aip-number">157</span>
        Partial responses
      </a>
    </li>
    <li class="nav-item">
      <a href="/158">
        <span class="aip-number">158</span>
        Pagination
      </a>
    </li>
    <li class="nav-item">
      <a href="/159">
        <span class="aip-number">159</span>
        Reading across collections
      </a>
    </li>
    <li class="nav-item">
      <a href="/160">
        <span class="aip-number">160</span>
        Filtering
      </a>
    </li>
    <li class="nav-item">
      <a href="/161">
        <span class="aip-number">161</span>
        Field masks
      </a>
    </li>
    <li class="nav-item">
      <a href="/162">
        <span class="aip-number">162</span>
        Resource Revisions
      </a>
    </li>
    <li class="nav-item">
      <a href="/163">
        <span class="aip-number">163</span>
        Change validation
      </a>
    </li>
    <li class="nav-item">
      <a href="/164">
        <span class="aip-number">164</span>
        Soft delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/165">
        <span class="aip-number">165</span>
        Criteria-based delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/180">
        <span class="aip-number">180</span>
        Backwards compatibility
      </a>
    </li>
    <li class="nav-item">
      <a href="/181">
        <span class="aip-number">181</span>
        Stability levels
      </a>
    </li>
    <li class="nav-item">
      <a href="/182">
        <span class="aip-number">182</span>
        External software dependencies
      </a>
    </li>
    <li class="nav-item">
      <a href="/191">
        <span class="aip-number">191</span>
        File and directory structure
      </a>
    </li>
    <li class="nav-item">
      <a href="/192">
        <span class="aip-number">192</span>
        Documentation
      </a>
    </li>
    <li class="nav-item nav-item-active">
      <a href="/193">
        <span class="aip-number">193</span>
        Errors
      </a>
    </li>
    <li class="nav-item">
      <a href="/194">
        <span class="aip-number">194</span>
        Automatic retry configuration
      </a>
    </li>
    <li class="nav-item">
      <a href="/200">
        <span class="aip-number">200</span>
        Precedent
      </a>
    </li>
    <li class="nav-item">
      <a href="/202">
        <span class="aip-number">202</span>
        Fields
      </a>
    </li>
    <li class="nav-item">
      <a href="/203">
        <span class="aip-number">203</span>
        Field behavior documentation
      </a>
    </li>
    <li class="nav-item">
      <a href="/205">
        <span class="aip-number">205</span>
        Beta-blocking changes
      </a>
    </li>
    <li class="nav-item">
      <a href="/210">
        <span class="aip-number">210</span>
        Unicode
      </a>
    </li>
    <li class="nav-item">
      <a href="/211">
        <span class="aip-number">211</span>
        Authorization checks
      </a>
    </li>
    <li class="nav-item">
      <a href="/213">
        <span class="aip-number">213</span>
        Common components
      </a>
    </li>
    <li class="nav-item">
      <a href="/214">
        <span class="aip-number">214</span>
        Resource expiration
      </a>
    </li>
    <li class="nav-item">
      <a href="/215">
        <span class="aip-number">215</span>
        API-specific protos
      </a>
    </li>
    <li class="nav-item">
      <a href="/216">
        <span class="aip-number">216</span>
        States
      </a>
    </li>
    <li class="nav-item">
      <a href="/217">
        <span class="aip-number">217</span>
        Unreachable resources
      </a>
    </li>
    <li class="nav-item">
      <a href="/231">
        <span class="aip-number">231</span>
        Batch methods: Get
      </a>
    </li>
    <li class="nav-item">
      <a href="/233">
        <span class="aip-number">233</span>
        Batch methods: Create
      </a>
    </li>
    <li class="nav-item">
      <a href="/234">
        <span class="aip-number">234</span>
        Batch methods: Update
      </a>
    </li>
    <li class="nav-item">
      <a href="/235">
        <span class="aip-number">235</span>
        Batch methods: Delete
      </a>
    </li>
    <li class="nav-item">
      <a href="/236">
        <span class="aip-number">236</span>
        Policy preview
      </a>
    </li>
    </ul>
</nav>
<section id="jump-content">
          
<aside id="aip-sidebar" class="docs-component-sidebar">
  <table id="aip-summary">
    <tr><th colspan="2">Errors</th></tr>
    <tr><td>Number</td><td>193</td></tr>
    <tr><td>Permalink</td><td><a href="https://google.aip.dev/193">google.aip.dev/193</a></td></tr>
    <tr><td>State</td><td>Approved</td></tr>
    <tr><td>Created</td><td>2019-07-26</td></tr>
    <tr><td>Updated</td><td>2019-07-26</td></tr>
  </table>

  <section id="aip-toc" class="docs-component-sidebar-toc">
    <div class="toc"><span class="toctitle">Contents</span><ul>
<li><a href="#guidance">Guidance</a><ul>
<li><a href="#details">Details</a></li>
<li><a href="#error-messages">Error messages</a></li>
<li><a href="#partial-errors">Partial errors</a></li>
<li><a href="#permission-denied">Permission Denied</a></li>
</ul>
</li>
<li><a href="#rationale">Rationale</a><ul>
<li><a href="#requiring-errorinfo">Requiring ErrorInfo</a></li>
<li><a href="#localizedmessage">LocalizedMessage</a></li>
</ul>
</li>
<li><a href="#further-reading">Further reading</a></li>
<li><a href="#changelog">Changelog</a></li>
</ul>
</div>

  </section>

  <section class="docs-component-sidebar-actions">
    <ul>
      <li><a href="https://github.com/aip-dev/google.aip.dev/issues/">File Bug</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/blob/master/aip/general/0193.md">View source</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/edit/master/aip/general/0193.md">Edit this page</a></li>
    </ul>
  </section>
</aside>
<section id="aip-main" class="docs-component-main">
  <section class="section-breadcrumbs">
  <nav
    class="glue-breadcrumbs glue-mod-mt-std glue-mod-mb-std"
    aria-label="You are here."
  >
    <ol class="glue-breadcrumbs__list aip-breadcrumbs">
      <li class="glue-breadcrumbs__item" aria-level="1">
        <a class="glue-breadcrumbs__link" href="/">
          API Improvement Proposals
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item" aria-level="2">
        <a class="glue-breadcrumbs__link" href="/general">
          General AIPs
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item glue-breadcrumbs__item--active"
          aria-level="3">
        Errors
      </li>
    </ol>
  </nav>
</section>
  
  <h4 class="aip-number">AIP-193</h4>
  <h1 id="errors">Errors</h1>
<p>Effective error communication is an important part of designing simple and
intuitive APIs. Services returning standardized error responses enable API
clients to construct centralized common error handling logic. This common logic
simplifies API client applications and eliminates the need for cumbersome
custom error handling code.</p>
<h2 id="guidance">Guidance</h2>
<p>Services <strong>must</strong> return a <a href="https://github.com/googleapis/googleapis/blob/master/google/rpc/status.proto"><code>google.rpc.Status</code></a> message when an API
error occurs, and <strong>must</strong> use the canonical error codes defined in
<a href="https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto"><code>google.rpc.Code</code></a>. More information about the particular codes is
available in the <a href="https://github.com/grpc/grpc/blob/master/doc/statuscodes.md">gRPC status code documentation</a>.</p>
<p>Error messages <strong>should</strong> help a reasonably technical user <em>understand</em> and
<em>resolve</em> the issue, and <strong>should not</strong> assume that the user is an expert in
your particular API. Additionally, error messages <strong>must not</strong> assume that the
user will know anything about its underlying implementation.</p>
<p>Error messages <strong>should</strong> be brief but actionable. Any extra information
<strong>should</strong> be provided in the <code>details</code> field. If even more information is
necessary, you <strong>should</strong> provide a link where a reader can get more
information or ask questions to help resolve the issue.</p>
<p>A JSON representation of an error response might look like the
following:</p>
<p><a name="sample"></a></p>
<div class="highlight language-json"><pre><span></span><code><span class="p">{</span>
  <span class="nt">&quot;error&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;code&quot;</span><span class="p">:</span> <span class="mi">429</span><span class="p">,</span>
    <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;The zone &#39;us-east1-a&#39; does not have enough resources available to fulfill the request. Try a different zone, or try again later.&quot;</span><span class="p">,</span>
    <span class="nt">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;RESOURCE_EXHAUSTED&quot;</span><span class="p">,</span>
    <span class="nt">&quot;details&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="nt">&quot;@type&quot;</span><span class="p">:</span> <span class="s2">&quot;type.googleapis.com/google.rpc.ErrorInfo&quot;</span><span class="p">,</span>
        <span class="nt">&quot;reason&quot;</span><span class="p">:</span> <span class="s2">&quot;STOCKOUT&quot;</span><span class="p">,</span>
        <span class="nt">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;compute.googleapis.com&quot;</span><span class="p">,</span>
        <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;zone&quot;</span><span class="p">:</span> <span class="s2">&quot;us-east1-a&quot;</span><span class="p">,</span>
          <span class="nt">&quot;vmType&quot;</span><span class="p">:</span> <span class="s2">&quot;e2-medium&quot;</span><span class="p">,</span>
          <span class="nt">&quot;attachment&quot;</span><span class="p">:</span> <span class="s2">&quot;local-ssd=3,nvidia-t4=2&quot;</span>
         <span class="p">}</span>
       <span class="p">},</span>
       <span class="p">{</span>
        <span class="nt">&quot;@type&quot;</span><span class="p">:</span> <span class="s2">&quot;type.googleapis.com/google.rpc.LocalizedMessage&quot;</span><span class="p">,</span>
        <span class="nt">&quot;locale&quot;</span><span class="p">:</span> <span class="s2">&quot;en-US&quot;</span><span class="p">,</span>
        <span class="nt">&quot;message&quot;</span><span class="p">:</span> <span class="s2">&quot;A e2-medium with local-ssd=3,nvidia-t4=2 is currently unavailable in the us-east1-a zone.\nCapacity changes frequently, so try your request in a different zone, with a different VM hardware configuration, or at a later time. For more information, see troubleshooting documentation.&quot;</span>
       <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="details">Details</h3>
<p>Google defines a set of <a href="https://github.com/googleapis/googleapis/blob/master/google/rpc/error_details.proto">standard detail payloads</a> for error details,
which cover most common needs for API errors. Services <strong>should</strong> use these
standard details payloads when feasible.</p>
<p>Structured details with machine-readable identifiers <strong>must</strong> be used if users
will need to write code against a specific aspect of the error. Error message
strings <strong>may</strong> change over time; however, if an error message does not have a
machine-readable identifier <em>in addition to</em> the <code>code</code> field, changing the
error message <strong>must</strong> be considered a backwards-incompatible change.</p>
<h4 id="errorinfo">ErrorInfo</h4>
<p>The <a href="https://github.com/googleapis/googleapis/blob/6f3fcc058ff29989f6d3a71557a44b5e81b897bd/google/rpc/error_details.proto#L27-L76"><code>ErrorInfo</code></a> message is the required way to send a
machine-readable identifier. All error responses <strong>must</strong> include an
<code>ErrorInfo</code> payload in the <code>details</code> field. Variable information
<strong>should</strong> be included in the <code>metadata</code> field on <code>ErrorInfo</code> and
<strong>must</strong> be included if it appears within an error message.</p>
<h4 id="uniqueness">Uniqueness</h4>
<p>Each type of detail payload <strong>must</strong> be included at most once. For
example, there <strong>must not</strong> be more than one <a href="https://github.com/googleapis/googleapis/blob/477a59d764428136ba1d857a9633c0d231de6efa/google/rpc/error_details.proto#L168-L218"><code>BadRequest</code></a>
message in the <code>details</code> field, but there <strong>may</strong> be a <code>BadRequest</code> and
a <a href="https://github.com/googleapis/googleapis/blob/6f3fcc058ff29989f6d3a71557a44b5e81b897bd/google/rpc/error_details.proto#L139-L166"><code>PreconditionFailure</code></a>.</p>
<p><strong>Note:</strong> <code>ErrorInfo</code> represents a special case. There <strong>must</strong> be exactly one
<code>ErrorInfo</code>. It is required.</p>
<h3 id="error-messages">Error messages</h3>
<p>For each error, the service <strong>must</strong> populate the <code>message</code> field on
<a href="https://github.com/googleapis/googleapis/blob/master/google/rpc/status.proto"><code>google.rpc.Status</code></a>. This error message,</p>
<ul>
<li>is a developer-facing, human-readable "debug message"</li>
<li>is presented in the service's native language</li>
<li>both explains the error and offers an actionable resolution to it
  (<a href="https://cloud.google.com/apis/design/errors#error_model">citation</a>)</li>
</ul>
<p><strong>Note:</strong> Sometimes a service will elect to always present
<code>Status.message</code> in English rather than the application's native
language so that messages are easily searchable in common knowledge
bases, such as StackOverflow&trade;.</p>
<p>When introducing an error that represents a failure scenario that did
not previously occur for the service, the payload <strong>must</strong> include
<code>ErrorInfo</code> and any variables found in dynamic segments of the error
message <strong>must</strong> be present in <code>ErrorInfo.metadata</code>. See, "<a href="#dynamic-variables">Dynamic
variables</a>".</p>
<h4 id="changing-error-messages">Changing error messages</h4>
<p><a name="status-message-warning"></a></p>
<p><code>Status.message</code> <strong>may</strong> change. However, <strong>use extreme caution</strong> when
doing so.  API consumers often treat this error message as <strong>part of the
API contract</strong>. Clients perform string matches on the text to
differentiate one error for another and even parse the error message to
extract variables from dynamic segments.</p>
<p>There is a safer alternative. The service can chose to include an error
message by adding <a href="https://github.com/googleapis/googleapis/blob/e9897ed945336e2dc967b439ac7b4be6d2c62640/google/rpc/error_details.proto#L275-L285"><code>google.rpc.LocalizedMessage</code></a> to
<a href="https://github.com/googleapis/googleapis/blob/aeae5ea2b01ece6c0cee046ae84b881cdc62b95d/google/rpc/status.proto#L46-L48"><code>Status.details</code></a>.</p>
<p>The error message presented in <code>LocalizedMessage.message</code> <strong>may</strong> be the
same as <code>Status.message</code> or it <strong>may</strong> be an alternate message.</p>
<p>Reasons to present the same error message in both locations include the
following:</p>
<ul>
<li>The service plans to localize either immediately or in the near
  future.  See, "<a href="#localization">Localization</a>".</li>
<li>It affords clients the ability to find an error message consistently
  in one location, <code>LocalizedMessaage.message</code>, across all methods of
  the API Service.</li>
</ul>
<p>Reasons to present an error message in <code>LocalizedMessage.message</code> that
differs from <code>Status.message</code> include the following:</p>
<ul>
<li>The service requires an end-user facing error message that differs
  from the "debug message".</li>
<li>Ongoing, iterative error message improvements are expected.</li>
</ul>
<p>When including <code>LocalizedMessage</code>, both fields, <code>locale</code> and <code>message</code>,
<strong>must</strong> be populated.  If the service is to be localized, the value of
<code>locale</code> <strong>must</strong> change dynamically. See,
"<a href="#localization">Localization</a>". Otherwise, <code>locale</code> <strong>must</strong> always
present the service's default locale, e.g. "en-US".</p>
<p>When adding an error message via <code>LocalizedMessage</code>, <code>ErrorInfo</code>
<strong>must</strong> be introduced either before or at the same time. If there are
dynamic segments found in the text, the values of these variables
<strong>must</strong> be included in <code>ErrorInfo.metadata</code>.  See, "<a href="#dynamic-variables">Dynamic
variables</a>".</p>
<p><strong>Warning:</strong> If <code>LocalizedMessage</code> is released without <code>ErrorInfo</code>, the
same <a href="#status-message-warning">concerns</a> regarding client misuse of
textual error messages apply.</p>
<h4 id="dynamic-variables">Dynamic variables</h4>
<p>The best, actionable error messages include dynamic segments. These
variable parts of the message are specific to a particular request.
Consider the following example:</p>
<blockquote>
<p>The Book, "The Great Gatsby", is unavailable at the Library, "Garfield
East". It is expected to be available again on 2199-05-13.</p>
</blockquote>
<p>The preceding error message is made actionable by the context, both that
originates from the request, the title of the Book and the name of the
Library, and by the information that is known only by the service, i.e.
the expected return date of the Book.</p>
<p>All dynamic variables found in error messages <strong>must</strong> also be present
in the <code>map&lt;string, string&gt;</code>, <code>ErrorInfo.metadata</code> (found on the
<em>required</em> <code>ErrorInfo</code>).  For example, the <code>metadata</code> map for the sample
error message above will include <em>at least</em> the following key/value
pairs:</p>
<div class="highlight language-yaml"><pre><span></span><code><span class="nt">bookTitle</span><span class="p">:</span> <span class="s">&quot;The</span><span class="nv"> </span><span class="s">Great</span><span class="nv"> </span><span class="s">Gatsby&quot;</span>
<span class="nt">library</span><span class="p">:</span> <span class="s">&quot;Garfield</span><span class="nv"> </span><span class="s">East&quot;</span>
<span class="nt">expectedReturnDate</span><span class="p">:</span> <span class="s">&quot;2199-05-13&quot;</span>
</code></pre></div>
<p>Dynamic variables that do not appear in an error message <strong>may</strong> also be
included in <code>metadata</code> to provide additional information to the client
to be used programmatically.</p>
<p>Once present in <code>metadata</code>, keys <strong>must</strong> continue to be included in the
map for the error payload to be backwards compatible, even if the value
for a particular key is empty. Keys <strong>must</strong> be expressed as lower
camel-case.</p>
<h4 id="localization">Localization</h4>
<p>The value of <code>Status.message</code> <strong>should</strong> be presented in the service's
native language. If a localized error message is required, the service
<strong>must</strong> include <a href="https://github.com/googleapis/googleapis/blob/e9897ed945336e2dc967b439ac7b4be6d2c62640/google/rpc/error_details.proto#L275-L285"><code>google.rpc.LocalizedMessage</code></a> in
<code>Status.details</code>.</p>
<h3 id="partial-errors">Partial errors</h3>
<p>APIs <strong>should not</strong> support partial errors. Partial errors add significant
complexity for users, because they usually sidestep the use of error codes, or
move those error codes into the response message, where the user must write
specialized error handling logic to address the problem.</p>
<p>However, occasionally partial errors are necessary, particularly in bulk
operations where it would be hostile to users to fail an entire large request
because of a problem with a single entry.</p>
<p>Methods that require partial errors <strong>should</strong> use <a href="/151">long-running operations</a>,
and the method <strong>should</strong> put partial failure information in the metadata
message. The errors themselves <strong>must</strong> still be represented with a
<a href="https://github.com/googleapis/googleapis/blob/master/google/rpc/status.proto"><code>google.rpc.Status</code></a> object.</p>
<h3 id="permission-denied">Permission Denied</h3>
<p>If the user does not have permission to access the resource or parent,
regardless of whether or not it exists, the service <strong>must</strong> error with
<code>PERMISSION_DENIED</code> (HTTP 403). Permission <strong>must</strong> be checked prior to checking
if the resource or parent exists.</p>
<p>If the user does have proper permission, but the requested resource or parent
does not exist, the service <strong>must</strong> error with <code>NOT_FOUND</code> (HTTP 404).</p>
<h2 id="rationale">Rationale</h2>
<h3 id="requiring-errorinfo">Requiring ErrorInfo</h3>
<p><code>ErrorInfo</code> is required because it further identifies an error. With
only approximately twenty <a href="https://github.com/googleapis/googleapis/blob/master/google/rpc/code.proto">available values</a> for <code>Status.status</code>,
it is difficult to disambiguate one error from another across an entire
<a href="https://cloud.google.com/apis/design/glossary#api_service">API Service</a>.</p>
<p>Also, error messages often contain dynamic segments that express
variable information, so there needs to be machine readable component of
<em>every</em> error response that enables clients to use such information
programmatically.</p>
<h3 id="localizedmessage">LocalizedMessage</h3>
<p><code>LocalizedMessage</code> was selected as the location to present alternate
error messages. This is desirable when clients need to display a crafted
error message directly to end users. <code>LocalizedMessage</code> can be used with
a static <code>locale</code>. This may seem misleading, but it allows the service
to eventually localize without having to duplicate or move the error
message, which would be a backwards incompatible change.</p>
<h2 id="further-reading">Further reading</h2>
<ul>
<li>For which error codes to retry, see <a href="https://aip.dev/194">AIP-194</a>.</li>
<li>For how to retry errors in client libraries, see
  <a href="https://aip.dev/client-libraries/4221">AIP-4221</a>.</li>
</ul>
<h2 id="changelog">Changelog</h2>
<ul>
<li><strong>2023-05-17</strong>: Change the recommended language for <code>Status.message</code>
  to be the service's native language rather than English.</li>
<li><strong>2023-05-17</strong>: Specify requirements for changing error messages.</li>
<li><strong>2023-05-10</strong>: Require <a href="https://github.com/googleapis/googleapis/blob/6f3fcc058ff29989f6d3a71557a44b5e81b897bd/google/rpc/error_details.proto#L27-L76"><code>ErrorInfo</code></a> for all error
  responses.</li>
<li><strong>2023-05-04</strong>: Require uniqueness by message type for error details.</li>
<li><strong>2022-11-04</strong>: Added guidance around PERMISSION_DENIED errors previously
  found in other AIPs.</li>
<li><strong>2022-08-12</strong>: Reworded/Simplified intro to add clarity to the intent.</li>
<li><strong>2020-01-22</strong>: Added a reference to the <a href="https://github.com/googleapis/googleapis/blob/6f3fcc058ff29989f6d3a71557a44b5e81b897bd/google/rpc/error_details.proto#L27-L76"><code>ErrorInfo</code></a> message.</li>
<li><strong>2019-10-14</strong>: Added guidance restricting error message mutability to if
  there is a machine-readable identifier present.</li>
<li><strong>2019-09-23</strong>: Added guidance about error message strings being able to
  change.</li>
</ul>
<!-- prettier-ignore-start -->
<!-- prettier-ignore-end -->
  <footer>
  Except as otherwise noted, the content of this page is licensed under the
  <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
  Attribution 4.0 License</a>, and code samples are licensed under the
  <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
  <span class="no-print">For details, see <a href="/licensing">content
  licensing</a>.</span>
</footer>
</section>

        </section>
      </main>
      
    </div>
    <script src="//www.gstatic.com/external_hosted/hammerjs/v2_0_2/hammer.min.js"></script>
    <script src="//www.gstatic.com/glue/v22_1/glue-vanilla.min.js"></script>
    <script type="text/javascript">
      const headerElement = document.querySelector('.glue-header');
      if (headerElement) {
        new window.glue.ui.header.Header(headerElement);
      }
    </script>
  </body>
</html>