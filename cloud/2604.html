<!DOCTYPE html>
<html lang="en-US" class="glue-flexbox">
  <head>
    <title>AIP-2604: Numeric arguments</title>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,maximum-scale=2">
    <link href="//fonts.googleapis.com/css?family=Roboto:100,300,400,500,700|Google+Sans:400,500|Product+Sans:400&amp;lang=en" rel="stylesheet"></link>
    <link rel="shortcut icon" href="/assets/favicon.ico">
    <link rel="stylesheet" type="text/css" media="screen" href="//www.gstatic.com/glue/v22_1/glue.min.css">
    <link rel="stylesheet" type="text/css" media="screen" href="/assets/css/style.css?v=3ace135b">
    <link rel="stylesheet" type="text/css" media="print" href="/assets/css/print.css?v=3ace135b">
    <script type="text/javascript" src="//code.jquery.com/jquery-3.4.0.min.js"></script>
    <script type="text/javascript" src="//www.gstatic.com/glue/latest/glue-detect.min.js"></script>
    <script type="text/javascript">
      $('html').css('visibility', 'hidden');
      $.when($.ready).then(() => {
        $('html').css('visibility', 'visible');
      });
    </script>
    <script type="text/javascript" src="/assets/js/global.js?v=3ace135b"></script>
    
<script type="text/javascript" src="/assets/js/syntax.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140054909-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-140054909-1');
    </script>
  </head>
  <body>
    <!-- prettier-ignore -->
<header class="glue-header glue-header--single">
  <div class="glue-header__bar glue-header__bar--desktop glue-header__drawer">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- LINK BAR-->
      <div class="glue-header__container glue-header__container--flex-auto">
        <nav class="glue-header__link-bar">
          <ul id="list-1" class="glue-header__list">
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/general" aria-level="1">Browse AIPs</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/news" aria-level="1">News</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/faq" aria-level="1">FAQ</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="/contributing" aria-level="1">Contributing</a>
                </li>
              
            
              
                <li class="glue-header__item">
                  <a class="glue-header__link" href="https://linter.aip.dev/" target="_blank" aria-level="1">
                    API Linter
                    <svg role="img" class="glue-icon glue-icon--18px">
                      <use xlink:href="/assets/images/glue-icons.svg#open-in-new"></use>
                    </svg>
                  </a>
                </li>
              
            
          </ul>
        </nav>
      </div>
      <!-- CTA-->
      <div class="glue-header__container glue-header__container--cta">
        <div class="glue-header__cta">
        <div class="glue-sitesearch">
          <form method="GET" action="/search">
          <label for="q">Search this site</label>
          <input class="glue-sitesearch__input" type="text" name="q" id="q"
            placeholder="Search AIPs">
          <button type="submit" class="glue-button glue-sitesearch__submit" title="Submit">
            <svg role="img" class="glue-icon glue-icon--24px">
            <use xlink:href="/assets/images/glue-icons.svg#search"></use>
            </svg>
          </button>
          </form>
        </div>
        <a href="https://github.com/aip-dev/google.aip.dev" target="_blank" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <!-- Mobile header placeholder -->
  <div class="glue-header__bar glue-header__bar--mobile">
    <div class="glue-header__tier">
      <!-- LOCK up-->
      <div class="glue-header__container">
        <div class="glue-header__lock-up">
          <div class="glue-header__hamburger glue-header__hamburger--first-tier">
            <div class="glue-header__hamburger-wrapper">
              <button type="button" class="glue-header__drawer-toggle-btn"
                aria-controls="drawer" aria-expanded="false" aria-label="Open the navigation drawer">
                <svg role="img" class="glue-icon glue-icon--24px"><use xlink:href="/assets/images/glue-icons.svg#menu"></use></svg>
              </button>
            </div>
          </div>
          <div class="glue-header__logo">
            <a class="glue-header__logo-link" href="/" title="Google">
              <div class="glue-header__logo-container">
                <svg role="img" aria-hidden="true" class="glue-header__logo-svg">
                  <use xlink:href="/assets/images/glue-icons.svg#google-color-logo"></use>
                </svg>
              </div>
              <p class="glue-header__logo--product">AIPs</p>
            </a>
          </div>
          <!-- SKIP -->
          <a href="#page-content" class="glue-header__skip-content">
            <p class="glue-header__skip-content-text">Jump to Content</p>
          </a>
        </div>
      </div>
      <!-- CTA -->
      <div class="glue-header__container">
        <div class="glue-header__cta">
        <a href="https://github.com/aip-dev/google.aip.dev" class="glue-button glue-button--high-emphasis">
          <img src="/assets/images/github.png" class="github-logo">
          View on GitHub
        </a>
        </div>
      </div>
    </div>
  </div>
  <div class="glue-header__drawer-backdrop"></div>
</header>
    <div class="glue-page">
      
      <main role="main" id="page-content">
        
<nav id="aip-nav" class="docs-component-nav">
  <ul class="nav-list">
    <li class="nav-item nav-item-header">AIPs by Scope</li>
    <li class="nav-item">
      <a href="/general">General</a>
    </li>
    <li class="nav-item">
      <a href="/cloud">Google Cloud Platform</a>
    </li>
    <li class="nav-item">
      <a href="/auth">Auth</a>
    </li>
    <li class="nav-item">
      <a href="/client-libraries">Client libraries</a>
    </li>
    <li class="nav-item">
      <a href="/apps">Workspace</a>
    </li>
    <li class="nav-item">
      <a href="/aog">Actions on Google</a>
    </li>
    <li class="nav-item nav-item-header">AIPs</li>
    <li class="nav-item">
      <a href="/2510">
        <span class="aip-number">2510</span>
        Project identifiers
      </a>
    </li>
    <li class="nav-item">
      <a href="/2602">
        <span class="aip-number">2602</span>
        Parameter-dependent arguments
      </a>
    </li>
    <li class="nav-item">
      <a href="/2603">
        <span class="aip-number">2603</span>
        List command arguments
      </a>
    </li>
    <li class="nav-item nav-item-active">
      <a href="/2604">
        <span class="aip-number">2604</span>
        Numeric arguments
      </a>
    </li>
    </ul>
</nav>
<section id="jump-content">
          
<aside id="aip-sidebar" class="docs-component-sidebar">
  <table id="aip-summary">
    <tr><th colspan="2">Numeric arguments</th></tr>
    <tr><td>Number</td><td>2604</td></tr>
    <tr><td>Permalink</td><td><a href="https://google.aip.dev/cloud/2604">google.aip.dev/cloud/2604</a></td></tr>
    <tr><td>Scope</td><td>Google Cloud Platform</td></tr>
    <tr><td>State</td><td>Approved</td></tr>
    <tr><td>Created</td><td>2019-06-13</td></tr>
    <tr><td>Updated</td><td>2019-06-13</td></tr>
  </table>

  <section id="aip-toc" class="docs-component-sidebar-toc">
    <div class="toc"><span class="toctitle">Contents</span><ul>
<li><a href="#guidance">Guidance</a><ul>
<li><a href="#flag-layout">Flag layout</a></li>
<li><a href="#flag-naming">Flag naming</a></li>
<li><a href="#flag-type">Flag type</a></li>
</ul>
</li>
<li><a href="#alternatives-considered">Alternatives considered</a><ul>
<li><a href="#one-flag-where-percentage-is-specified-if-the-flag-value-ends-with-and-number-is-assumed-otherwise">One flag, where percentage is specified if the flag value ends with '%', and number is assumed otherwise</a></li>
<li><a href="#one-flag-where-percentage-is-specified-if-the-flag-value-ends-with-and-number-is-specified-if-the-flag-value-ends-with-n">One flag, where percentage is specified if the flag value ends with '%', and number is specified if the flag value ends with 'n'</a></li>
</ul>
</li>
<li><a href="#exceptions">Exceptions</a></li>
</ul>
</div>

  </section>

  <section class="docs-component-sidebar-actions">
    <ul>
      <li><a href="https://github.com/aip-dev/google.aip.dev/issues/">File Bug</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/blob/master/aip/cloud/2604.md">View source</a></li>
      <li><a href="https://github.com/aip-dev/google.aip.dev/edit/master/aip/cloud/2604.md">Edit this page</a></li>
    </ul>
  </section>
</aside>
<section id="aip-main" class="docs-component-main">
  <section class="section-breadcrumbs">
  <nav
    class="glue-breadcrumbs glue-mod-mt-std glue-mod-mb-std"
    aria-label="You are here."
  >
    <ol class="glue-breadcrumbs__list aip-breadcrumbs">
      <li class="glue-breadcrumbs__item" aria-level="1">
        <a class="glue-breadcrumbs__link" href="/">
          API Improvement Proposals
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item" aria-level="2">
        <a class="glue-breadcrumbs__link" href="/cloud">
          Google Cloud Platform AIPs
        </a>
      </li>
      
      <li class="glue-breadcrumbs__item glue-breadcrumbs__item--active"
          aria-level="3">
        Numeric arguments
      </li>
    </ol>
  </nav>
</section>
  
  <h4 class="aip-number">AIP-2604</h4>
  <h1 id="numeric-arguments">Numeric arguments</h1>
<p>Some API fields refer to either a percentage or a fixed number. For example, in
GCE a group can be created with a configurable limit for either the percentage
or number of instances in the group that can undergo maintenance
simultaneously:</p>
<div class="highlight language-proto"><pre><span></span><code><span class="kd">message</span> <span class="nc">ConcurrencyControl</span> <span class="p">{</span>
  <span class="kd">enum</span> <span class="n">LimitType</span> <span class="p">{</span>
    <span class="na">INVALID</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="na">PERCENT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="na">FIXED</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">optional</span> <span class="kt">int32</span> <span class="na">concurrency_limit</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">optional</span> <span class="n">LimitType</span> <span class="na">limit_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="guidance">Guidance</h2>
<h3 id="flag-layout">Flag layout</h3>
<p>In gcloud, such API fields should correspond to a mutually exclusive group
consisting of two flags: one for specifying a number, and the other for
specifying a percentage. The API field in the example above would thus
correspond to the following surface specification in gcloud:</p>
<div class="highlight language-yaml"><pre><span></span><code><span class="p p-Indicator">-</span> <span class="nt">group</span><span class="p">:</span>
    <span class="nt">mutex</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="nt">arguments</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">concurrency-limit</span>
        <span class="nt">help_text</span><span class="p">:</span> <span class="p p-Indicator">|</span>
          <span class="no">Maximum number of instances in the group that can undergo maintenance</span>
          <span class="no">simultaneously.</span>
      <span class="p p-Indicator">-</span> <span class="nt">name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">concurrency-limit-percent</span>
        <span class="nt">help_text</span><span class="p">:</span> <span class="p p-Indicator">|</span>
          <span class="no">Integer from 0 to 100 representing the maximum percentage of instances</span>
          <span class="no">in the group that can undergo maintenance simultaneously.</span>
</code></pre></div>
<h3 id="flag-naming">Flag naming</h3>
<p>Any flag taking a percentage should end with <code>-percent</code> (not <code>-percentage</code>).</p>
<h3 id="flag-type">Flag type</h3>
<p>Any flag taking a percentage should take an integer from 0 to 100. If more
precision is required, it is acceptable to take a float from 0 to 100.</p>
<h2 id="alternatives-considered">Alternatives considered</h2>
<h3 id="one-flag-where-percentage-is-specified-if-the-flag-value-ends-with-and-number-is-assumed-otherwise">One flag, where percentage is specified if the flag value ends with '%', and number is assumed otherwise</h3>
<p>In other words, to specify 10% one would use <code>--concurrency-limit=10%</code>, and to
specify 10 instances one would use <code>--concurrency-limit=10</code>.</p>
<p>This would be a cleaner design since it naturally maps a single concept (the
limit) to a single flag (<code>--concurrency-limit</code>), avoiding the need for
additional flags that clutter the help text.</p>
<p>However, the main reason not to prefer this approach is that it significantly
increases the risk of user error. For instance, suppose a group currently
contains 20 instances with a concurrency limit of 10%, and a user wishes to
update the limit to 20%. If the user issues a describe command (or performs a
GET request) to see the existing limit, the API response will contain something
like:</p>
<div class="highlight language-yaml"><pre><span></span><code><span class="nt">concurrencyControl</span><span class="p">:</span>
  <span class="nt">concurrencyLimit</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">10</span>
  <span class="nt">limitType</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">PERCENT</span>
</code></pre></div>
<p>It's easy for the user to gloss over limitType and just assume that
<code>--concurrency-limit=20</code> will update the limit to 20%. However, in reality this
would set the limit to 20 instances (100% of the group), potentially leading to
catastrophic consequences.</p>
<p>The recommend approach avoids this ambiguity at the expense of some elegance,
but we deem this tradeoff necessary.</p>
<h3 id="one-flag-where-percentage-is-specified-if-the-flag-value-ends-with-and-number-is-specified-if-the-flag-value-ends-with-n">One flag, where percentage is specified if the flag value ends with '%', and number is specified if the flag value ends with 'n'</h3>
<p>In other words, to specify 10% one would use <code>--concurrency-limit=10%</code>, and to
specify 10 instances one would use <code>--concurrency-limit=10n</code>. It would be an
error to provide a value that doesn't end in '%' or 'n'.</p>
<p>While this avoids the potential for a user to confuse percentages and numbers,
requiring 'n' at the end of a number is inelegant UX. A number should obviously
resemble a number, and the choice of 'n' is also rather arbitrary.</p>
<h2 id="exceptions">Exceptions</h2>
<p>This CIP does not apply for API fields like timestamps, where we allow the user
to enter either absolute times or durations in the same flag. This is because
absolute times and durations have natural formats that differ, and thus there's
no potential for a user to confuse the two. In general if this is the case, one
flag that accepts both formats should be preferred for the sake of UX
simplicity.</p>
  <footer>
  Except as otherwise noted, the content of this page is licensed under the
  <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons
  Attribution 4.0 License</a>, and code samples are licensed under the
  <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a>.
  <span class="no-print">For details, see <a href="/licensing">content
  licensing</a>.</span>
</footer>
</section>

        </section>
      </main>
      
    </div>
    <script src="//www.gstatic.com/external_hosted/hammerjs/v2_0_2/hammer.min.js"></script>
    <script src="//www.gstatic.com/glue/v22_1/glue-vanilla.min.js"></script>
    <script type="text/javascript">
      const headerElement = document.querySelector('.glue-header');
      if (headerElement) {
        new window.glue.ui.header.Header(headerElement);
      }
    </script>
  </body>
</html>